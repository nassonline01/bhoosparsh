{% extends 'dashboard/seller/base.html' %}
{% load static %}

{% block title %}Enquiries - 99acres Seller{% endblock %}

{% block extra_css %}
<style>
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .card-animate {
        animation: slideIn 0.6s ease-out forwards;
        opacity: 0;
    }

    .stats-card {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .stats-card:hover {
        transform: translateY(-5px);
    }

    .enquiry-card {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(229, 231, 235, 0.5);
    }

    .enquiry-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border-color: #0E68B9;
    }

    .stagger-1 { animation-delay: 0.1s; }
    .stagger-2 { animation-delay: 0.2s; }
    .stagger-3 { animation-delay: 0.3s; }
    .stagger-4 { animation-delay: 0.4s; }
    .stagger-5 { animation-delay: 0.5s; }

    /* Enquiry specific styles */
    .enquiry-status-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
    }

    .status-new {
        background: #3B82F6;
        color: white;
    }

    .status-contacted {
        background: #F59E0B;
        color: white;
    }

    .status-interested {
        background: #10B981;
        color: white;
    }

    .status-scheduled {
        background: #8B5CF6;
        color: white;
    }

    .status-negotiation {
        background: #EC4899;
        color: white;
    }

    .status-closed {
        background: #6B7280;
        color: white;
    }

    .priority-hot {
        background: #DC2626;
        color: white;
    }

    .priority-high {
        background: #EA580C;
        color: white;
    }

    .priority-medium {
        background: #D97706;
        color: white;
    }

    .priority-low {
        background: #6B7280;
        color: white;
    }

    .source-badge {
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 500;
    }

    .source-phone {
        background: #10B981;
        color: white;
    }

    .source-whatsapp {
        background: #25D366;
        color: white;
    }

    .source-email {
        background: #3B82F6;
        color: white;
    }

    .source-form {
        background: #8B5CF6;
        color: white;
    }

    /* Modal styles */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 100;
        backdrop-filter: blur(4px);
        animation: fadeIn 0.3s ease-out;
    }

    .modal-overlay.active {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background: white;
        border-radius: 16px;
        padding: 24px;
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
    }

    .dark .modal-content {
        background: #1f2937;
    }

    .filter-select {
        background: transparent;
        border: 1px solid rgba(229, 231, 235, 0.5);
        border-radius: 8px;
        padding: 10px 12px;
        width: 100%;
        color: #374151;
    }

    .dark .filter-select {
        background: #374151;
        border-color: #4B5563;
        color: #D1D5DB;
    }

    .filter-select:focus {
        outline: none;
        border-color: #0E68B9;
        box-shadow: 0 0 0 3px rgba(14, 104, 185, 0.1);
    }

    .search-input {
        background: transparent;
        border: 1px solid rgba(229, 231, 235, 0.5);
        border-radius: 8px;
        padding: 10px 16px;
        width: 100%;
        color: #374151;
    }

    .dark .search-input {
        background: #374151;
        border-color: #4B5563;
        color: #D1D5DB;
    }

    .search-input:focus {
        outline: none;
        border-color: #0E68B9;
        box-shadow: 0 0 0 3px rgba(14, 104, 185, 0.1);
    }

    .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: white;
    }

    .avatar-blue {
        background: #3B82F6;
    }

    .avatar-green {
        background: #10B981;
    }

    .avatar-purple {
        background: #8B5CF6;
    }

    .avatar-orange {
        background: #F59E0B;
    }

    /* Chat bubble styles */
    .chat-bubble {
        max-width: 70%;
        padding: 10px 15px;
        border-radius: 18px;
        position: relative;
    }

    .chat-bubble-sender {
        background: #0E68B9;
        color: white;
        border-bottom-right-radius: 4px;
        align-self: flex-end;
    }

    .chat-bubble-receiver {
        background: #f3f4f6;
        color: #374151;
        border-bottom-left-radius: 4px;
        align-self: flex-start;
    }

    .dark .chat-bubble-receiver {
        background: #374151;
        color: #d1d5db;
    }

    /* Loading animation */
    .loading-skeleton {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
    }

    .dark .loading-skeleton {
        background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
    }

    @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }
</style>
{% endblock %}

{% block header_title %}
<h1 class="text-xl font-bold text-gray-900 dark:text-white">Enquiries & Leads</h1>
<p class="text-sm text-gray-600 dark:text-gray-400">Manage and respond to property enquiries from interested buyers</p>
{% endblock %}

{% block header_buttons %}
<button onclick="openExportModal()" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition flex items-center gap-2">
    <i class="fas fa-download"></i>
    <span>Export</span>
</button>
<a href="{% url 'seller_property_create' %}" class="px-4 py-2 bg-99acres-orange text-white rounded-lg hover:bg-orange-600 transition flex items-center gap-2">
    <i class="fas fa-plus"></i>
    <span>Post Property</span>
</a>
{% endblock %}

{% block content %}
<!-- Enquiry Stats -->
<div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
    <div class="stats-card card-animate stagger-1">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm h-full">
            <div class="flex items-center">
                <div class="rounded-full bg-blue-100 dark:bg-blue-900 p-3 mr-4">
                    <i class="fas fa-inbox text-99acres-blue text-xl"></i>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{{ total_enquiries|default:48 }}</h2>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Total Enquiries</p>
                </div>
            </div>
        </div>
    </div>

    <div class="stats-card card-animate stagger-2">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm h-full">
            <div class="flex items-center">
                <div class="rounded-full bg-yellow-100 dark:bg-yellow-900 p-3 mr-4">
                    <i class="fas fa-star text-yellow-600 dark:text-yellow-400 text-xl"></i>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{{ new_today_count|default:3 }}</h2>
                    <p class="text-sm text-gray-600 dark:text-gray-400">New Today</p>
                </div>
            </div>
        </div>
    </div>

    <div class="stats-card card-animate stagger-3">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm h-full">
            <div class="flex items-center">
                <div class="rounded-full bg-green-100 dark:bg-green-900 p-3 mr-4">
                    <i class="fas fa-phone text-green-600 dark:text-green-400 text-xl"></i>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{{ contacted_count|default:8 }}</h2>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Contacted</p>
                </div>
            </div>
        </div>
    </div>

    <div class="stats-card card-animate stagger-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm h-full">
            <div class="flex items-center">
                <div class="rounded-full bg-purple-100 dark:bg-purple-900 p-3 mr-4">
                    <i class="fas fa-thumbs-up text-purple-600 dark:text-purple-400 text-xl"></i>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{{ interested_count|default:12 }}</h2>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Interested</p>
                </div>
            </div>
        </div>
    </div>

    <div class="stats-card card-animate stagger-5">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm h-full">
            <div class="flex items-center">
                <div class="rounded-full bg-red-100 dark:bg-red-900 p-3 mr-4">
                    <i class="fas fa-fire text-red-600 dark:text-red-400 text-xl"></i>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{{ hot_leads_count|default:2 }}</h2>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Hot Leads</p>
                </div>
            </div>
        </div>
    </div>

    <div class="stats-card card-animate stagger-1">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm h-full">
            <div class="flex items-center">
                <div class="rounded-full bg-teal-100 dark:bg-teal-900 p-3 mr-4">
                    <i class="fas fa-reply text-teal-600 dark:text-teal-400 text-xl"></i>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{{ response_rate|default:"92%" }}</h2>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Response Rate</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Filters & Search -->
<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6 mb-6 card-animate">
    <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4">
        <div class="flex flex-wrap gap-2">
            <button onclick="filterEnquiries('all')" class="px-4 py-2 bg-99acres-blue text-white rounded-lg hover:bg-blue-700 transition filter-btn active">
                All ({{ total_enquiries|default:48 }})
            </button>
            <button onclick="filterEnquiries('new')" class="px-4 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition filter-btn">
                New ({{ new_today_count|default:3 }})
            </button>
            <button onclick="filterEnquiries('hot')" class="px-4 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition filter-btn">
                Hot ({{ hot_leads_count|default:2 }})
            </button>
            <button onclick="filterEnquiries('contacted')" class="px-4 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition filter-btn">
                Contacted ({{ contacted_count|default:8 }})
            </button>
            <button onclick="filterEnquiries('scheduled')" class="px-4 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition filter-btn">
                Site Visit ({{ site_visit_count|default:5 }})
            </button>
        </div>
        <div class="relative lg:w-64">
            <input type="text" id="enquirySearch" class="search-input" placeholder="Search by name, phone, or property...">
            <button onclick="searchEnquiries()" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-99acres-blue transition">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </div>
</div>

<!-- Enquiries List -->
<div class="space-y-4" id="enquiriesContainer">
    <!-- Hot Enquiry 1 -->
    <div class="enquiry-card bg-white dark:bg-gray-800 rounded-2xl overflow-hidden shadow-sm border-2 border-red-500">
        <div class="p-5">
            <div class="flex flex-col lg:flex-row lg:items-start justify-between gap-4">
                <div class="flex-1">
                    <div class="flex items-start gap-4">
                        <div class="avatar avatar-blue text-lg font-bold">AK</div>
                        <div class="flex-1">
                            <div class="flex flex-wrap items-center gap-3 mb-2">
                                <h3 class="font-bold text-lg text-gray-900 dark:text-white">Anil Kumar</h3>
                                <span class="enquiry-status-badge status-new">New</span>
                                <span class="enquiry-status-badge priority-hot">Hot Lead</span>
                                <span class="source-badge source-phone">Phone Call</span>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
                                <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-home text-99acres-blue"></i>
                                    <a href="#" class="text-99acres-blue hover:text-blue-700 transition font-medium">
                                        3BHK Apartment in Bandra West
                                    </a>
                                </div>
                                <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-map-marker-alt text-red-500"></i>
                                    <span class="font-medium">Mumbai, Maharashtra</span>
                                </div>
                                <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-money-bill-wave text-green-600"></i>
                                    <span class="font-medium">Budget: ₹2.5 Crores</span>
                                </div>
                            </div>
                            <div class="flex flex-wrap items-center gap-4 mb-3">
                                <div class="flex items-center gap-2 text-sm font-medium">
                                    <i class="fas fa-phone text-green-600"></i>
                                    <span class="bg-green-50 dark:bg-green-900/30 px-3 py-1 rounded-lg">+91 98765 43210</span>
                                </div>
                                <div class="flex items-center gap-2 text-sm font-medium">
                                    <i class="fab fa-whatsapp text-green-600"></i>
                                    <span class="bg-green-50 dark:bg-green-900/30 px-3 py-1 rounded-lg">WhatsApp Available</span>
                                </div>
                            </div>
                            <div class="bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded-lg border border-yellow-200 dark:border-yellow-700">
                                <p class="text-sm text-gray-700 dark:text-gray-300 italic">
                                    <i class="fas fa-quote-left text-yellow-500 mr-2"></i>
                                    "I'm ready to buy immediately if the property matches my requirements. Can we schedule a site visit this weekend?"
                                </p>
                            </div>
                            <div class="mt-3">
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    <span class="font-medium">Requirements:</span> 3BHK, 2 Parking, Near International School, Ready to Move
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="lg:text-right">
                    <div class="text-sm text-gray-500 mb-2 flex items-center gap-2">
                        <i class="fas fa-clock"></i>
                        <span>Today • 10:30 AM</span>
                    </div>
                    <div class="text-sm text-gray-500 mb-4">
                        <span class="inline-flex items-center gap-1">
                            <i class="fas fa-eye"></i>
                            Viewed property 3 times
                        </span>
                    </div>
                    <div class="flex lg:justify-end gap-2">
                        <select class="filter-select enquiry-status" data-enquiry-id="1" onchange="updateEnquiryStatus(1, this.value)" style="width: auto;">
                            <option value="new" selected>New Enquiry</option>
                            <option value="contacted">Contacted</option>
                            <option value="interested">Interested</option>
                            <option value="site_visit">Site Visit</option>
                            <option value="negotiation">Price Negotiation</option>
                            <option value="closed">Closed</option>
                        </select>
                        <button onclick="addNote(1)" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="px-5 pb-5">
            <div class="flex flex-wrap items-center justify-between gap-3">
                <div class="text-sm text-gray-500">
                    <i class="fas fa-history mr-2"></i>
                    <span>Received 2 hours ago</span>
                </div>
                <div class="flex flex-wrap gap-2">
                    <a href="tel:+919876543210" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center gap-2">
                        <i class="fas fa-phone"></i>
                        <span>Call Now</span>
                    </a>
                    <a href="https://wa.me/919876543210" target="_blank" class="px-4 py-2 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-400 rounded-lg hover:bg-green-200 dark:hover:bg-green-800 transition flex items-center gap-2">
                        <i class="fab fa-whatsapp"></i>
                        <span>WhatsApp</span>
                    </a>
                    <button onclick="viewConversation(1)" class="px-4 py-2 bg-99acres-blue text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2">
                        <i class="fas fa-comments"></i>
                        <span>Chat</span>
                    </button>
                    <button onclick="viewEnquiryDetails(1)" class="px-4 py-2 border border-99acres-blue text-99acres-blue rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition flex items-center gap-2">
                        <i class="fas fa-eye"></i>
                        <span>Details</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enquiry 2 - NRI Buyer -->
    <div class="enquiry-card bg-white dark:bg-gray-800 rounded-2xl overflow-hidden shadow-sm">
        <div class="p-5">
            <div class="flex flex-col lg:flex-row lg:items-start justify-between gap-4">
                <div class="flex-1">
                    <div class="flex items-start gap-4">
                        <div class="avatar avatar-orange text-lg font-bold">PS</div>
                        <div class="flex-1">
                            <div class="flex flex-wrap items-center gap-3 mb-2">
                                <h3 class="font-bold text-lg text-gray-900 dark:text-white">Priya Sharma (NRI)</h3>
                                <span class="enquiry-status-badge status-contacted">Contacted</span>
                                <span class="enquiry-status-badge priority-high">High</span>
                                <span class="source-badge source-whatsapp">WhatsApp</span>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
                                <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-home text-99acres-blue"></i>
                                    <a href="#" class="text-99acres-blue hover:text-blue-700 transition font-medium">
                                        2BHK Flat in Andheri East
                                    </a>
                                </div>
                                <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-map-marker-alt text-red-500"></i>
                                    <span class="font-medium">Mumbai, Maharashtra</span>
                                </div>
                                <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-money-bill-wave text-green-600"></i>
                                    <span class="font-medium">Budget: ₹1.2 Crores</span>
                                </div>
                            </div>
                            <div class="flex flex-wrap items-center gap-4 mb-3">
                                <div class="flex items-center gap-2 text-sm font-medium">
                                    <i class="fas fa-phone text-green-600"></i>
                                    <span class="bg-blue-50 dark:bg-blue-900/30 px-3 py-1 rounded-lg">+1 (555) 987-6543 (US)</span>
                                </div>
                                <div class="flex items-center gap-2 text-sm font-medium">
                                    <i class="fas fa-clock text-blue-600"></i>
                                    <span class="bg-blue-50 dark:bg-blue-900/30 px-3 py-1 rounded-lg">US Timezone (10:30 PM IST)</span>
                                </div>
                            </div>
                            <div class="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg border border-blue-200 dark:border-blue-700">
                                <p class="text-sm text-gray-700 dark:text-gray-300">
                                    <span class="font-medium">NRI Buyer:</span> Looking for investment property in Mumbai. Will be visiting India next month for property inspection. Prefers video call for initial discussion.
                                </p>
                            </div>
                            <div class="mt-3">
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    <span class="font-medium">Requirements:</span> 2BHK, Rental Yield 5%+, Near Metro, Society with amenities
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="lg:text-right">
                    <div class="text-sm text-gray-500 mb-2 flex items-center gap-2">
                        <i class="fas fa-clock"></i>
                        <span>Yesterday • 02:15 PM</span>
                    </div>
                    <div class="text-sm text-gray-500 mb-4">
                        <span class="inline-flex items-center gap-1">
                            <i class="fas fa-plane"></i>
                            NRI from USA
                        </span>
                    </div>
                    <div class="flex lg:justify-end gap-2">
                        <select class="filter-select enquiry-status" data-enquiry-id="2" onchange="updateEnquiryStatus(2, this.value)" style="width: auto;">
                            <option value="new">New Enquiry</option>
                            <option value="contacted" selected>Contacted</option>
                            <option value="interested">Interested</option>
                            <option value="site_visit">Site Visit</option>
                            <option value="negotiation">Price Negotiation</option>
                            <option value="closed">Closed</option>
                        </select>
                        <button onclick="addNote(2)" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="px-5 pb-5">
            <div class="flex flex-wrap items-center justify-between gap-3">
                <div class="text-sm text-gray-500">
                    <i class="fas fa-history mr-2"></i>
                    <span>Last contact: Today 11:00 AM</span>
                </div>
                <div class="flex flex-wrap gap-2">
                    <button onclick="scheduleVideoCall(2)" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition flex items-center gap-2">
                        <i class="fas fa-video"></i>
                        <span>Video Call</span>
                    </button>
                    <a href="https://wa.me/15559876543" target="_blank" class="px-4 py-2 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-400 rounded-lg hover:bg-green-200 dark:hover:bg-green-800 transition flex items-center gap-2">
                        <i class="fab fa-whatsapp"></i>
                        <span>WhatsApp</span>
                    </a>
                    <button onclick="sendEmail(2)" class="px-4 py-2 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-400 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-800 transition flex items-center gap-2">
                        <i class="fas fa-envelope"></i>
                        <span>Email</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enquiry 3 - Hot Lead -->
    <div class="enquiry-card bg-white dark:bg-gray-800 rounded-2xl overflow-hidden shadow-sm border-2 border-red-500">
        <div class="p-5">
            <div class="flex flex-col lg:flex-row lg:items-start justify-between gap-4">
                <div class="flex-1">
                    <div class="flex items-start gap-4">
                        <div class="avatar avatar-green text-lg font-bold">RK</div>
                        <div class="flex-1">
                            <div class="flex flex-wrap items-center gap-3 mb-2">
                                <h3 class="font-bold text-lg text-gray-900 dark:text-white">Rajesh Kumar</h3>
                                <span class="enquiry-status-badge status-interested">Very Interested</span>
                                <span class="enquiry-status-badge priority-hot">Hot Lead</span>
                                <span class="source-badge source-email">Email</span>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
                                <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-home text-99acres-blue"></i>
                                    <a href="#" class="text-99acres-blue hover:text-blue-700 transition font-medium">
                                        Villa in Powai
                                    </a>
                                </div>
                                <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-map-marker-alt text-red-500"></i>
                                    <span class="font-medium">Mumbai, Maharashtra</span>
                                </div>
                                <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-money-bill-wave text-green-600"></i>
                                    <span class="font-medium">Budget: ₹4.8 Crores</span>
                                </div>
                            </div>
                            <div class="flex flex-wrap items-center gap-4 mb-3">
                                <div class="flex items-center gap-2 text-sm font-medium">
                                    <i class="fas fa-envelope text-blue-600"></i>
                                    <span class="bg-blue-50 dark:bg-blue-900/30 px-3 py-1 rounded-lg">rajesh.kumar@example.com</span>
                                </div>
                                <div class="flex items-center gap-2 text-sm font-medium">
                                    <i class="fas fa-user-tie text-purple-600"></i>
                                    <span class="bg-purple-50 dark:bg-purple-900/30 px-3 py-1 rounded-lg">Business Owner</span>
                                </div>
                            </div>
                            <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded-lg border border-green-200 dark:border-green-700">
                                <p class="text-sm text-gray-700 dark:text-gray-300">
                                    <span class="font-medium">Progress:</span> Price negotiated to ₹4.5Cr. Requested for property documents. Site visit scheduled for Saturday. Bank loan pre-approval received.
                                </p>
                            </div>
                            <div class="mt-3">
                                <div class="flex items-center justify-between text-sm mb-1">
                                    <span class="text-gray-600 dark:text-gray-400">Deal Progress</span>
                                    <span class="font-medium">85%</span>
                                </div>
                                <div class="custom-progress">
                                    <div class="custom-progress-bar" style="width: 85%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="lg:text-right">
                    <div class="text-sm text-gray-500 mb-2 flex items-center gap-2">
                        <i class="fas fa-clock"></i>
                        <span>2 days ago • 11:45 AM</span>
                    </div>
                    <div class="text-sm text-gray-500 mb-4">
                        <span class="inline-flex items-center gap-1">
                            <i class="fas fa-calendar-check text-green-600"></i>
                            Site visit: Saturday 3 PM
                        </span>
                    </div>
                    <div class="flex lg:justify-end gap-2">
                        <select class="filter-select enquiry-status" data-enquiry-id="3" onchange="updateEnquiryStatus(3, this.value)" style="width: auto;">
                            <option value="new">New Enquiry</option>
                            <option value="contacted">Contacted</option>
                            <option value="interested" selected>Interested</option>
                            <option value="site_visit">Site Visit</option>
                            <option value="negotiation">Price Negotiation</option>
                            <option value="closed">Closed</option>
                        </select>
                        <button onclick="addNote(3)" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="px-5 pb-5">
            <div class="flex flex-wrap items-center justify-between gap-3">
                <div class="text-sm text-gray-500">
                    <i class="fas fa-history mr-2"></i>
                    <span>Last update: Today 2:30 PM</span>
                </div>
                <div class="flex flex-wrap gap-2">
                    <button onclick="sendDocuments(3)" class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition flex items-center gap-2">
                        <i class="fas fa-file-pdf"></i>
                        <span>Send Documents</span>
                    </button>
                    <a href="mailto:rajesh.kumar@example.com" class="px-4 py-2 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-400 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-800 transition flex items-center gap-2">
                        <i class="fas fa-envelope"></i>
                        <span>Email</span>
                    </a>
                    <button onclick="viewEnquiryDetails(3)" class="px-4 py-2 border border-99acres-blue text-99acres-blue rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition flex items-center gap-2">
                        <i class="fas fa-eye"></i>
                        <span>Details</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Response Rate & Performance -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-8">
    <div class="card-animate">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6">
            <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">Response Performance</h3>
            <div class="space-y-4">
                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span class="text-gray-600 dark:text-gray-400">Response Rate</span>
                        <span class="font-medium">{{ response_rate|default:"92%" }}</span>
                    </div>
                    <div class="custom-progress">
                        <div class="custom-progress-bar" style="width: 92%"></div>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span class="text-gray-600 dark:text-gray-400">Average Response Time</span>
                        <span class="font-medium">2.5 hours</span>
                    </div>
                    <div class="custom-progress">
                        <div class="custom-progress-bar" style="width: 75%"></div>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span class="text-gray-600 dark:text-gray-400">Conversion Rate</span>
                        <span class="font-medium">25%</span>
                    </div>
                    <div class="custom-progress">
                        <div class="custom-progress-bar" style="width: 25%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card-animate">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6">
            <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">Enquiry Sources</h3>
            <div class="space-y-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <i class="fab fa-whatsapp text-green-500"></i>
                        <span class="text-sm text-gray-600 dark:text-gray-400">WhatsApp</span>
                    </div>
                    <span class="font-medium">35%</span>
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-phone text-blue-500"></i>
                        <span class="text-sm text-gray-600 dark:text-gray-400">Phone Call</span>
                    </div>
                    <span class="font-medium">30%</span>
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-envelope text-purple-500"></i>
                        <span class="text-sm text-gray-600 dark:text-gray-400">Email</span>
                    </div>
                    <span class="font-medium">20%</span>
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-mouse-pointer text-orange-500"></i>
                        <span class="text-sm text-gray-600 dark:text-gray-400">Website Form</span>
                    </div>
                    <span class="font-medium">15%</span>
                </div>
            </div>
        </div>
    </div>

    <div class="card-animate">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6">
            <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">Quick Actions</h3>
            <div class="space-y-3">
                <button onclick="openBulkAction()" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition flex items-center justify-center gap-2">
                    <i class="fas fa-users"></i>
                    <span>Bulk Message</span>
                </button>
                <button onclick="openExportModal()" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition flex items-center justify-center gap-2">
                    <i class="fas fa-file-export"></i>
                    <span>Export to Excel</span>
                </button>
                <button onclick="openReminderModal()" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition flex items-center justify-center gap-2">
                    <i class="fas fa-bell"></i>
                    <span>Set Reminders</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Pagination -->
<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-4 mt-6 card-animate">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div class="text-sm text-gray-600 dark:text-gray-400">
            Showing 1 to 3 of {{ total_enquiries|default:48 }} enquiries • 
            <span class="font-medium">{{ hot_leads_count|default:2 }} Hot Leads</span>
        </div>
        <nav class="flex items-center gap-1">
            <button class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition disabled:opacity-50" disabled>
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="px-4 py-2 bg-99acres-blue text-white rounded-lg">1</button>
            <button class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition">2</button>
            <button class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition">3</button>
            <span class="px-2 text-gray-500">...</span>
            <button class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition">16</button>
            <button class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                <i class="fas fa-chevron-right"></i>
            </button>
        </nav>
    </div>
</div>

<!-- Modals -->
<!-- Enquiry Details Modal -->
<div id="enquiryDetailsModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 800px;">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-bold text-gray-900 dark:text-white">Enquiry Details & History</h3>
            <button onclick="closeModal('enquiryDetailsModal')" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="enquiryDetailsContent" class="space-y-6">
            <!-- Content loaded dynamically -->
        </div>
    </div>
</div>

<!-- Chat Modal -->
<div id="chatModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 600px; height: 80vh;">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-bold text-gray-900 dark:text-white">Chat with Enquirer</h3>
            <button onclick="closeModal('chatModal')" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="chatContent" class="space-y-4 max-h-[60vh] overflow-y-auto">
            <!-- Chat messages loaded dynamically -->
        </div>
        <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
            <div class="flex gap-2">
                <input type="text" id="chatInput" class="search-input flex-1" placeholder="Type your message...">
                <button onclick="sendChatMessage()" class="px-4 py-2 bg-99acres-blue text-white rounded-lg hover:bg-blue-700 transition">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Export Modal -->
<div id="exportModal" class="modal-overlay">
    <div class="modal-content">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-bold text-gray-900 dark:text-white">Export Enquiries</h3>
            <button onclick="closeModal('exportModal')" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Export Format</label>
                <select class="filter-select w-full">
                    <option value="csv">CSV (Excel)</option>
                    <option value="excel">Excel File (.xlsx)</option>
                    <option value="pdf">PDF Report</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Date Range</label>
                <select class="filter-select w-full">
                    <option value="last_30d">Last 30 Days</option>
                    <option value="last_7d">Last 7 Days</option>
                    <option value="this_month">This Month</option>
                    <option value="last_month">Last Month</option>
                    <option value="custom">Custom Range</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Include Fields</label>
                <div class="space-y-2">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" checked class="rounded">
                        <span class="text-sm">Contact Information</span>
                    </label>
                    <label class="flex items-center gap-2">
                        <input type="checkbox" checked class="rounded">
                        <span class="text-sm">Enquiry Details</span>
                    </label>
                    <label class="flex items-center gap-2">
                        <input type="checkbox" class="rounded">
                        <span class="text-sm">Communication History</span>
                    </label>
                    <label class="flex items-center gap-2">
                        <input type="checkbox" class="rounded">
                        <span class="text-sm">Notes & Comments</span>
                    </label>
                </div>
            </div>
        </div>
        <div class="flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
            <button onclick="closeModal('exportModal')" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                Cancel
            </button>
            <button onclick="exportEnquiries()" class="px-4 py-2 bg-99acres-blue text-white rounded-lg hover:bg-blue-700 transition">
                Export Now
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize animations
        const cards = document.querySelectorAll('.card-animate');
        cards.forEach((card, index) => {
            setTimeout(() => {
                card.style.animationDelay = `${index * 0.1}s`;
                card.style.opacity = '1';
            }, 100);
        });

        // Initialize event listeners
        initEventListeners();
    });

    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.remove('active');
    }

    function openModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.add('active');
    }

    function showToast(message, type = 'success') {
        // Use the toast function from base template
        const toastMessage = document.createElement('div');
        toastMessage.className = `p-4 rounded-lg shadow-lg flex items-center gap-3 ${
            type === 'success' ? 'bg-green-500 text-white' :
            type === 'error' ? 'bg-red-500 text-white' :
            type === 'warning' ? 'bg-yellow-500 text-white' :
            'bg-blue-500 text-white'
        }`;
        
        toastMessage.innerHTML = `
            <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
            <span>${message}</span>
        `;
        
        const container = document.getElementById('toast-container');
        container.appendChild(toastMessage);
        
        setTimeout(() => {
            if (toastMessage.parentElement) {
                toastMessage.remove();
            }
        }, 3000);
    }

    function initEventListeners() {
        // Search functionality
        document.getElementById('enquirySearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchEnquiries();
            }
        });

        // Filter button click
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Close modals when clicking outside
        document.addEventListener('click', function(event) {
            const modals = document.querySelectorAll('.modal-overlay');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // Chat input enter key
        const chatInput = document.getElementById('chatInput');
        if (chatInput) {
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });
        }
    }

    function filterEnquiries(filter) {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        
        showToast(`Filtering: ${filter} enquiries`, 'info');
    }

    function searchEnquiries() {
        const searchTerm = document.getElementById('enquirySearch').value.toLowerCase();
        if (!searchTerm) return;
        
        showToast(`Searching for "${searchTerm}"`, 'info');
    }

    function updateEnquiryStatus(enquiryId, status) {
        const statusBadge = document.querySelector(`[data-enquiry-id="${enquiryId}"]`);
        if (statusBadge) {
            statusBadge.value = status;
        }
        showToast(`Enquiry ${enquiryId} status updated to ${status}`, 'success');
    }

    function addNote(enquiryId) {
        const note = prompt(`Add note for enquiry ${enquiryId}:`);
        if (note) {
            showToast(`Note added to enquiry ${enquiryId}`, 'success');
        }
    }

    function viewEnquiryDetails(enquiryId) {
        const enquiryData = {
            1: {
                name: 'Anil Kumar',
                phone: '+91 98765 43210',
                email: 'anil.kumar@example.com',
                property: '3BHK Apartment in Bandra West',
                location: 'Mumbai, Maharashtra',
                budget: '₹2.5 Crores',
                source: 'Phone Call',
                status: 'New',
                priority: 'Hot Lead',
                message: 'I\'m ready to buy immediately if the property matches my requirements. Can we schedule a site visit this weekend?',
                date: 'Today, 10:30 AM',
                requirements: '3BHK, 2 Parking, Near International School, Ready to Move',
                timeline: 'Immediate Purchase',
                propertyType: 'Residential',
                leadSource: '99acres Website',
                lastActive: 'Active 10 mins ago',
                history: [
                    { date: 'Today 10:30 AM', action: 'Enquiry received via phone call' },
                    { date: 'Today 10:45 AM', action: 'Property details sent via WhatsApp' },
                    { date: 'Today 11:00 AM', action: 'Enquirer viewed property photos' }
                ]
            },
            2: {
                name: 'Priya Sharma (NRI)',
                phone: '+1 (555) 987-6543',
                email: 'priya.sharma@example.com',
                property: '2BHK Flat in Andheri East',
                location: 'Mumbai, Maharashtra',
                budget: '₹1.2 Crores',
                source: 'WhatsApp',
                status: 'Contacted',
                priority: 'High',
                message: 'Looking for investment property in Mumbai. Will be visiting India next month for property inspection.',
                date: 'Yesterday, 02:15 PM',
                requirements: '2BHK, Rental Yield 5%+, Near Metro, Society with amenities',
                timeline: 'Next Month',
                propertyType: 'Investment',
                leadSource: '99acres App',
                lastActive: 'Active 2 hours ago',
                history: [
                    { date: 'Yesterday 02:15 PM', action: 'Enquiry received via WhatsApp' },
                    { date: 'Today 11:00 AM', action: 'Video call scheduled for tomorrow' },
                    { date: 'Today 02:00 PM', action: 'Property brochure sent via email' }
                ]
            },
            3: {
                name: 'Rajesh Kumar',
                phone: '+91 98765 67890',
                email: 'rajesh.kumar@example.com',
                property: 'Villa in Powai',
                location: 'Mumbai, Maharashtra',
                budget: '₹4.8 Crores',
                source: 'Email',
                status: 'Interested',
                priority: 'Hot Lead',
                message: 'Negotiated price to ₹4.5Cr. Requested for property documents. Site visit scheduled.',
                date: '2 days ago, 11:45 AM',
                requirements: 'Villa, Garden, Security, Investment property',
                timeline: 'This Week',
                propertyType: 'Luxury Residential',
                leadSource: '99acres Email Campaign',
                lastActive: 'Active 30 mins ago',
                history: [
                    { date: '2 days ago 11:45 AM', action: 'Enquiry received via email' },
                    { date: 'Yesterday 03:30 PM', action: 'Price negotiation started' },
                    { date: 'Today 10:00 AM', action: 'Site visit scheduled for Saturday' },
                    { date: 'Today 02:30 PM', action: 'Bank loan pre-approval received' }
                ]
            }
        };
        
        const enquiry = enquiryData[enquiryId];
        const content = document.getElementById('enquiryDetailsContent');
        
        content.innerHTML = `
            <div class="space-y-6">
                <div class="flex items-start justify-between">
                    <div class="flex items-center gap-4">
                        <div class="avatar ${enquiryId === 1 ? 'avatar-blue' : enquiryId === 2 ? 'avatar-orange' : 'avatar-green'} text-xl font-bold">
                            ${enquiry.name.split(' ').map(n => n[0]).join('')}
                        </div>
                        <div>
                            <h4 class="font-bold text-xl text-gray-900 dark:text-white">${enquiry.name}</h4>
                            <div class="flex flex-wrap items-center gap-2 mt-1">
                                <span class="enquiry-status-badge status-${enquiry.status.toLowerCase().replace(' ', '_')}">${enquiry.status}</span>
                                <span class="enquiry-status-badge priority-${enquiry.priority.toLowerCase().replace(' ', '_')}">${enquiry.priority}</span>
                                <span class="source-badge source-${enquiry.source.toLowerCase().replace(' ', '_')}">${enquiry.source}</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-sm text-gray-500">
                        <i class="fas fa-clock mr-1"></i>
                        ${enquiry.lastActive}
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-5">
                        <h5 class="font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                            <i class="fas fa-user-circle"></i>
                            Contact Information
                        </h5>
                        <div class="space-y-3">
                            ${enquiry.phone ? `<div class="flex items-center gap-3">
                                <i class="fas fa-phone text-green-500"></i>
                                <div>
                                    <div class="font-medium">Phone</div>
                                    <a href="tel:${enquiry.phone}" class="text-99acres-blue hover:text-blue-700">${enquiry.phone}</a>
                                </div>
                            </div>` : ''}
                            ${enquiry.email ? `<div class="flex items-center gap-3">
                                <i class="fas fa-envelope text-blue-500"></i>
                                <div>
                                    <div class="font-medium">Email</div>
                                    <a href="mailto:${enquiry.email}" class="text-99acres-blue hover:text-blue-700">${enquiry.email}</a>
                                </div>
                            </div>` : ''}
                            <div class="flex items-center gap-3">
                                <i class="fas fa-calendar text-purple-500"></i>
                                <div>
                                    <div class="font-medium">Timeline</div>
                                    <div>${enquiry.timeline}</div>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <i class="fas fa-home text-orange-500"></i>
                                <div>
                                    <div class="font-medium">Property Type</div>
                                    <div>${enquiry.propertyType}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-5">
                        <h5 class="font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                            <i class="fas fa-home"></i>
                            Property Details
                        </h5>
                        <div class="space-y-3">
                            <div class="font-medium text-lg text-gray-900 dark:text-white">${enquiry.property}</div>
                            <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400">
                                <i class="fas fa-map-marker-alt"></i>
                                ${enquiry.location}
                            </div>
                            <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400">
                                <i class="fas fa-money-bill-wave"></i>
                                <span class="font-bold text-green-600">${enquiry.budget}</span>
                            </div>
                            <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400">
                                <i class="fas fa-chart-line"></i>
                                <span>Source: ${enquiry.leadSource}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-5">
                    <h5 class="font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                        <i class="fas fa-clipboard-list"></i>
                        Requirements & Message
                    </h5>
                    <div class="space-y-3">
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg">
                            <p class="text-gray-700 dark:text-gray-300 italic">"${enquiry.message}"</p>
                        </div>
                        <div>
                            <div class="font-medium mb-2">Specific Requirements:</div>
                            <p class="text-gray-600 dark:text-gray-400">${enquiry.requirements}</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-5">
                    <h5 class="font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                        <i class="fas fa-history"></i>
                        Communication History
                    </h5>
                    <div class="space-y-3">
                        ${enquiry.history.map(item => `
                            <div class="flex items-start gap-3">
                                <div class="w-2 h-2 mt-2 rounded-full bg-99acres-blue"></div>
                                <div class="flex-1">
                                    <div class="font-medium">${item.action}</div>
                                    <div class="text-sm text-gray-500">${item.date}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 pt-6 border-t border-gray-200 dark:border-gray-700">
                    ${enquiry.phone ? `<a href="tel:${enquiry.phone}" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center gap-2">
                        <i class="fas fa-phone"></i>
                        <span>Call</span>
                    </a>` : ''}
                    ${enquiry.email ? `<a href="mailto:${enquiry.email}" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2">
                        <i class="fas fa-envelope"></i>
                        <span>Email</span>
                    </a>` : ''}
                    <button onclick="viewConversation(${enquiryId})" class="px-4 py-2 bg-99acres-blue text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2">
                        <i class="fas fa-comments"></i>
                        <span>Chat History</span>
                    </button>
                </div>
            </div>
        `;
        
        openModal('enquiryDetailsModal');
    }

    function viewConversation(enquiryId) {
        const chatContent = document.getElementById('chatContent');
        chatContent.innerHTML = `
            <div class="space-y-4">
                <div class="flex flex-col items-start">
                    <div class="chat-bubble chat-bubble-receiver">
                        Hi, I'm interested in your property listed on 99acres. Can we discuss the details?
                    </div>
                    <div class="text-xs text-gray-500 mt-1">Yesterday 2:15 PM</div>
                </div>
                <div class="flex flex-col items-end">
                    <div class="chat-bubble chat-bubble-sender">
                        Hello! Thank you for your interest. I'd be happy to provide more details. What specific information would you like?
                    </div>
                    <div class="text-xs text-gray-500 mt-1">Yesterday 2:30 PM</div>
                </div>
                <div class="flex flex-col items-start">
                    <div class="chat-bubble chat-bubble-receiver">
                        Can you share more photos of the property and the exact location?
                    </div>
                    <div class="text-xs text-gray-500 mt-1">Yesterday 3:00 PM</div>
                </div>
                <div class="flex flex-col items-end">
                    <div class="chat-bubble chat-bubble-sender">
                        I've sent the photos and location details to your WhatsApp. Let me know if you need any more information.
                    </div>
                    <div class="text-xs text-gray-500 mt-1">Yesterday 3:15 PM</div>
                </div>
                <div class="flex flex-col items-start">
                    <div class="chat-bubble chat-bubble-receiver">
                        Thanks! I saw the photos. Is it possible to schedule a site visit this weekend?
                    </div>
                    <div class="text-xs text-gray-500 mt-1">Today 10:30 AM</div>
                </div>
            </div>
        `;
        
        openModal('chatModal');
    }

    function sendChatMessage() {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        
        if (message) {
            const chatContent = document.getElementById('chatContent');
            const newMessage = `
                <div class="flex flex-col items-end">
                    <div class="chat-bubble chat-bubble-sender">
                        ${message}
                    </div>
                    <div class="text-xs text-gray-500 mt-1">Just now</div>
                </div>
            `;
            chatContent.innerHTML += newMessage;
            input.value = '';
            
            // Auto-scroll to bottom
            chatContent.scrollTop = chatContent.scrollHeight;
            
            // Simulate reply
            setTimeout(() => {
                const replies = [
                    "Thank you for the information.",
                    "I'll check and get back to you.",
                    "Can we schedule a call to discuss this further?",
                    "I've shared the details with my family. We'll decide soon."
                ];
                const randomReply = replies[Math.floor(Math.random() * replies.length)];
                
                chatContent.innerHTML += `
                    <div class="flex flex-col items-start">
                        <div class="chat-bubble chat-bubble-receiver">
                            ${randomReply}
                        </div>
                        <div class="text-xs text-gray-500 mt-1">Just now</div>
                    </div>
                `;
                chatContent.scrollTop = chatContent.scrollHeight;
            }, 1000);
        }
    }

    function scheduleVideoCall(enquiryId) {
        const time = prompt("Schedule video call (Date and Time):");
        if (time) {
            showToast(`Video call scheduled for ${time}`, 'success');
        }
    }

    function sendDocuments(enquiryId) {
        showToast(`Property documents sent to enquiry ${enquiryId}`, 'success');
    }

    function sendEmail(enquiryId) {
        const subject = prompt("Email subject:");
        if (subject) {
            showToast(`Email prepared for enquiry ${enquiryId}`, 'success');
        }
    }

    function openExportModal() {
        openModal('exportModal');
    }

    function exportEnquiries() {
        showToast('Enquiries exported successfully', 'success');
        closeModal('exportModal');
    }

    function openBulkAction() {
        showToast('Bulk action feature coming soon', 'info');
    }

    function openReminderModal() {
        showToast('Reminder feature coming soon', 'info');
    }
</script>
{% endblock %}