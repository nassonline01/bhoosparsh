{% load static %}
{% load dashboard_filters %}
<!-- Dashboard Header -->
<header class="dashboard-header bg-white shadow-sm py-3">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col-auto">
                <!-- Sidebar Toggle -->
                <button class="btn btn-outline-secondary" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="col">
                <!-- Search Bar -->
                <div class="input-group">
                    <input type="text" 
                           class="form-control" 
                           placeholder="Search properties, users, or analytics..."
                           id="dashboardSearch">
                    <button class="btn btn-primary" type="button">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            
            <div class="col-auto">
                <div class="d-flex align-items-center gap-3">
                    <!-- Notifications -->
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary position-relative" 
                                type="button" 
                                data-bs-toggle="dropdown">
                            <i class="fas fa-bell"></i>
                            {% if alerts %}
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                {{ alerts|length }}
                            </span>
                            {% endif %}
                        </button>
                        <div class="dropdown-menu dropdown-menu-end p-0" style="width: 300px;">
                            <div class="p-3 border-bottom">
                                <h6 class="mb-0">Notifications</h6>
                            </div>
                            <div class="notification-list" style="max-height: 300px; overflow-y: auto;">
                                {% if alerts %}
                                {% for alert in alerts|slice:":5" %}
                                <a href="{{ alert.action.url|default:'#' }}" 
                                   class="dropdown-item d-flex align-items-center py-3 border-bottom">
                                    <div class="flex-shrink-0">
                                        <div class="rounded-circle bg-{{ alert.type }} text-white p-2">
                                            <i class="fas fa-{% if alert.type == 'warning' %}exclamation-triangle{% elif alert.type == 'danger' %}exclamation-circle{% else %}info-circle{% endif %}"></i>
                                        </div>
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <h6 class="mb-1">{{ alert.title }}</h6>
                                        <p class="mb-0 text-muted small">{{ alert.message|truncatechars:50 }}</p>
                                        <small class="text-muted">Just now</small>
                                    </div>
                                </a>
                                {% endfor %}
                                {% else %}
                                <div class="p-3 text-center">
                                    <i class="fas fa-bell-slash fa-2x text-muted mb-2"></i>
                                    <p class="mb-0 text-muted">No new notifications</p>
                                </div>
                                {% endif %}
                            </div>
                            <div class="p-2 border-top">
                                <a href="#" class="btn btn-sm btn-outline-primary w-100">
                                    View All Notifications
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Messages -->
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary position-relative" 
                                type="button" 
                                data-bs-toggle="dropdown">
                            <i class="fas fa-envelope"></i>
                            {% if recent_inquiries %}
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary">
                                {{ recent_inquiries|length }}
                            </span>
                            {% endif %}
                        </button>
                        <div class="dropdown-menu dropdown-menu-end p-0" style="width: 300px;">
                            <div class="p-3 border-bottom">
                                <h6 class="mb-0">Messages</h6>
                            </div>
                            <div class="message-list" style="max-height: 300px; overflow-y: auto;">
                                {% if recent_inquiries %}
                                {% for inquiry in recent_inquiries|slice:":3" %}
                                <a href="#" 
                                   class="dropdown-item d-flex align-items-center py-3 border-bottom"
                                   data-bs-toggle="modal" 
                                   data-bs-target="#inquiryModal{{ inquiry.id }}">
                                    <div class="flex-shrink-0">
                                        <div class="rounded-circle bg-light text-dark p-2">
                                            <i class="fas fa-user"></i>
                                        </div>
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <h6 class="mb-1">
                                            {{ inquiry.inquirer_name|truncatechars:20 }}
                                            <span class="badge bg-{{ inquiry.status|inquiry_status_color }} float-end">
                                                {{ inquiry.get_status_display }}
                                            </span>
                                        </h6>
                                        <p class="mb-0 text-muted small">{{ inquiry.message|truncatechars:40 }}</p>
                                        <small class="text-muted">{{ inquiry.created_at|timesince }} ago</small>
                                    </div>
                                </a>
                                {% endfor %}
                                {% else %}
                                <div class="p-3 text-center">
                                    <i class="fas fa-envelope fa-2x text-muted mb-2"></i>
                                    <p class="mb-0 text-muted">No new messages</p>
                                </div>
                                {% endif %}
                            </div>
                            <div class="p-2 border-top">
                                <a href="#" class="btn btn-sm btn-outline-primary w-100">
                                    View All Messages
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- User Profile -->
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary d-flex align-items-center gap-2" 
                                type="button" 
                                data-bs-toggle="dropdown">
                            {% if user.profile.avatar %}
                            <img src="{{ user.profile.avatar.url }}" 
                                 class="rounded-circle" 
                                 width="32" 
                                 height="32"
                                 alt="{{ user.full_name }}">
                            {% else %}
                            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center" 
                                 style="width: 32px; height: 32px;">
                                {{ user.first_name|first|upper }}
                            </div>
                            {% endif %}
                            <span class="d-none d-md-inline">{{ user.first_name }}</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            <div class="px-4 py-3">
                                <h6 class="mb-0">{{ user.full_name }}</h6>
                                <p class="text-muted small mb-0">{{ user.email }}</p>
                                <span class="badge bg-{{ user.user_type|user_type_color }} mt-2">
                                    {{ user.get_user_type_display }}
                                </span>
                            </div>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="{% url 'profile' %}">
                                <i class="fas fa-user me-2"></i> My Profile
                            </a>
                            <a class="dropdown-item" href="{% url 'edit_profile' %}">
                                <i class="fas fa-cog me-2"></i> Account Settings
                            </a>
                            <a class="dropdown-item" href="{% url 'dashboard' %}">
                                <i class="fas fa-crown me-2"></i> Membership
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#">
                                <i class="fas fa-question-circle me-2"></i> Help & Support
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item text-danger" href="{% url 'logout' %}">
                                <i class="fas fa-sign-out-alt me-2"></i> Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>