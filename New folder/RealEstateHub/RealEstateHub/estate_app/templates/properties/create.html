{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List Your Property - RealEstatePro</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- HTMX for AJAX -->
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* Dropzone Styles */
        .dropzone {
            border: 2px dashed #d1d5db;
            border-radius: 0.75rem;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .dropzone:hover, .dropzone.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        
        .image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .preview-item {
            position: relative;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .preview-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .preview-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .preview-item .remove-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .preview-item .remove-btn:hover {
            background: rgba(220, 38, 38, 0.9);
            transform: scale(1.1);
        }
        
        .preview-item .primary-badge {
            position: absolute;
            top: 0.5rem;
            left: 0.5rem;
            background: rgba(16, 185, 129, 0.9);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        /* Step Indicator */
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3rem;
            position: relative;
        }
        
        .step-indicator:before {
            content: '';
            position: absolute;
            top: 1.5rem;
            left: 0;
            right: 0;
            height: 2px;
            background: #e5e7eb;
            z-index: 1;
        }
        
        .step {
            position: relative;
            z-index: 2;
            text-align: center;
            flex: 1;
        }
        
        .step-number {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            background: white;
            border: 2px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.5rem;
            font-weight: 600;
            color: #9ca3af;
            transition: all 0.3s;
        }
        
        .step.active .step-number {
            background: #3b82f6;
            border-color: #3b82f6;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }
        
        .step.completed .step-number {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }
        
        .step-label {
            font-size: 0.875rem;
            color: #9ca3af;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        .step.active .step-label {
            color: #3b82f6;
            font-weight: 600;
        }
        
        .step-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .step-content.active {
            display: block;
        }
        
        /* Amenity Grid */
        .amenity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .amenity-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }
        
        .amenity-item:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
            transform: translateY(-1px);
        }
        
        .amenity-item.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.1);
        }
        
        .amenity-checkbox {
            display: none;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Form Styles */
        .form-input, .form-textarea, .form-select {
            transition: all 0.2s;
            border: 1px solid #d1d5db;
        }
        
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Loading Spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            background: linear-gradient(to right, #10b981, #059669);
        }
        
        .toast.error {
            background: linear-gradient(to right, #ef4444, #dc2626);
        }
        
        .toast.info {
            background: linear-gradient(to right, #3b82f6, #2563eb);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .step-indicator {
                flex-wrap: wrap;
            }
            
            .step {
                flex: 0 0 33.333%;
                margin-bottom: 1rem;
            }
            
            .amenity-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .toast {
                left: 20px;
                right: 20px;
                transform: translateY(-100px);
            }
            
            .toast.show {
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Toast Container -->
    <div id="toast-container"></div>
    
    <!-- Navigation -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <a href="{% url 'home' %}" class="flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-home text-white text-xl"></i>
                        </div>
                        <span class="text-xl font-bold text-gray-900">RealEstatePro</span>
                    </a>
                </div>
                
                <div class="hidden md:flex items-center space-x-6">
                    <a href="{% url 'list' %}" class="text-gray-600 hover:text-blue-600 font-medium transition-colors">
                        <i class="fas fa-search mr-2"></i>Browse
                    </a>
                    
                    {% if user.is_authenticated %}
                        <a href="{% url 'create' %}" class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all font-medium">
                            <i class="fas fa-plus mr-2"></i>List Property
                        </a>
                        <a href="{% url 'my_properties' %}" class="text-gray-600 hover:text-blue-600 font-medium transition-colors">
                            <i class="fas fa-list mr-2"></i>My Listings
                        </a>
                        <div class="relative group">
                            <button class="flex items-center space-x-2 text-gray-600 hover:text-blue-600 focus:outline-none">
                                <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full flex items-center justify-center text-white font-semibold">
                                    {{ user.first_name|first|upper }}
                                </div>
                                <i class="fas fa-chevron-down text-sm"></i>
                            </button>
                            <div class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                                <a href="{% url 'dashboard' %}" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                                </a>
                                <a href="{% url 'profile' %}" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-user mr-2"></i>Profile
                                </a>
                                <a href="{% url 'subscription_dashboard' %}" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-crown mr-2"></i>Membership
                                </a>
                                <div class="border-t my-2"></div>
                                <a href="{% url 'logout' %}" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                                </a>
                            </div>
                        </div>
                    {% else %}
                        <a href="{% url 'login' %}" class="text-gray-600 hover:text-blue-600 font-medium transition-colors">
                            <i class="fas fa-sign-in-alt mr-2"></i>Login
                        </a>
                        <a href="{% url 'register' %}" class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all font-medium">
                            Sign Up
                        </a>
                    {% endif %}
                </div>
                
                <!-- Mobile menu button -->
                <button id="mobile-menu-button" class="md:hidden text-gray-600 hover:text-blue-600">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
            
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden md:hidden mt-4 pt-4 border-t border-gray-200">
                <div class="space-y-3">
                    <a href="{% url 'list' %}" class="block text-gray-600 hover:text-blue-600 font-medium">
                        <i class="fas fa-search mr-2"></i>Browse
                    </a>
                    
                    {% if user.is_authenticated %}
                        <a href="{% url 'create' %}" class="block bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all font-medium text-center">
                            <i class="fas fa-plus mr-2"></i>List Property
                        </a>
                        <a href="{% url 'my_properties' %}" class="block text-gray-600 hover:text-blue-600 font-medium">
                            <i class="fas fa-list mr-2"></i>My Listings
                        </a>
                        <a href="{% url 'dashboard' %}" class="block text-gray-600 hover:text-blue-600 font-medium">
                            <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                        </a>
                        <a href="{% url 'profile' %}" class="block text-gray-600 hover:text-blue-600 font-medium">
                            <i class="fas fa-user mr-2"></i>Profile
                        </a>
                        <a href="{% url 'subscription_dashboard' %}" class="block text-gray-600 hover:text-blue-600 font-medium">
                            <i class="fas fa-crown mr-2"></i>Membership
                        </a>
                        <div class="pt-2 border-t">
                            <a href="{% url 'logout' %}" class="block text-gray-600 hover:text-blue-600 font-medium">
                                <i class="fas fa-sign-out-alt mr-2"></i>Logout
                            </a>
                        </div>
                    {% else %}
                        <a href="{% url 'login' %}" class="block text-gray-600 hover:text-blue-600 font-medium">
                            <i class="fas fa-sign-in-alt mr-2"></i>Login
                        </a>
                        <a href="{% url 'register' %}" class="block bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all font-medium text-center">
                            Sign Up
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Messages Display -->
    {% if messages %}
        <div class="container mx-auto px-4 mt-4">
            {% for message in messages %}
                <div class="mb-3 p-4 rounded-lg {% if message.tags == 'error' %}bg-red-100 border border-red-300 text-red-700{% elif message.tags == 'success' %}bg-green-100 border border-green-300 text-green-700{% else %}bg-blue-100 border border-blue-300 text-blue-700{% endif %}">
                    <div class="flex items-center">
                        {% if message.tags == 'error' %}
                            <i class="fas fa-exclamation-circle mr-3"></i>
                        {% elif message.tags == 'success' %}
                            <i class="fas fa-check-circle mr-3"></i>
                        {% else %}
                            <i class="fas fa-info-circle mr-3"></i>
                        {% endif %}
                        <span>{{ message }}</span>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Form Errors Display -->
    {% if form and form.errors %}
    <div class="container mx-auto px-4 mt-4">
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg">
            <h3 class="font-bold mb-2">Please fix the following errors:</h3>
            <ul class="list-disc pl-5 space-y-1">
                {% for field in form %}
                    {% for error in field.errors %}
                        <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                    {% endfor %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">List Your Property</h1>
            <p class="text-gray-600 text-lg">Fill in the details below to list your property. Reach thousands of potential buyers.</p>
        </div>

        <!-- Membership Status -->
        {% if membership %}
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 mb-8 border border-blue-200">
            <div class="flex flex-col md:flex-row md:items-center justify-between">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-1">Your Current Plan: <span class="text-blue-600">{{ membership.plan.name }}</span></h3>
                    <p class="text-gray-600">
                        {% if membership.plan.is_unlimited %}
                            Unlimited listings available
                        {% else %}
                            {{ listings_remaining }} listing{{ listings_remaining|pluralize }} remaining
                        {% endif %}
                        {% if membership.plan.max_featured > 0 %}
                            • {{ membership.plan.max_featured }} featured listing{{ membership.plan.max_featured|pluralize }} per month
                        {% endif %}
                    </p>
                </div>
                {% if not membership.plan.is_unlimited and listings_remaining != 'Unlimited' and listings_remaining <= 2 %}
                    <a href="{% url 'pricing' %}" class="mt-4 md:mt-0 inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-medium rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 shadow-sm hover:shadow-md">
                        <i class="fas fa-crown mr-2"></i>
                        Upgrade Plan
                    </a>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Step Indicator -->
        <div class="step-indicator mb-12">
            <div class="step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-label">Basic Info</div>
            </div>
            <div class="step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-label">Details</div>
            </div>
            <div class="step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-label">Location</div>
            </div>
            <div class="step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-label">Media</div>
            </div>
            <div class="step" data-step="5">
                <div class="step-number">5</div>
                <div class="step-label">Review</div>
            </div>
        </div>

        <!-- Property Creation Form -->
        <form method="POST" enctype="multipart/form-data" class="space-y-8" id="property-form" novalidate>
            {% csrf_token %}
            
            <!-- Step 1: Basic Information -->
            <div class="step-content active" id="step-1">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 md:p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Basic Information</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Title -->
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Property Title <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="title" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-input"
                                   placeholder="e.g., Luxury 3BHK Apartment with Sea View"
                                   required
                                   value="{{ form.title.value|default:'' }}">
                            {% if form.title.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.title.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Description -->
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Description <span class="text-red-500">*</span>
                            </label>
                            <textarea name="description" rows="5"
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-textarea"
                                      placeholder="Describe your property in detail. Highlight key features, amenities, and unique selling points."
                                      required>{{ form.description.value|default:'' }}</textarea>
                            {% if form.description.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.description.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Category -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Category <span class="text-red-500">*</span>
                            </label>
                            <select name="category" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-select"
                                    hx-get="{% url 'get_subcategories' %}"
                                    hx-target="#subcategory-container"
                                    hx-trigger="change"
                                    required>
                                <option value="">Select Category</option>
                                {% for category in categories %}
                                    <option value="{{ category.id }}" {% if form.category.value|stringformat:"s" == category.id|stringformat:"s" %}selected{% endif %}>
                                        {{ category.name }}
                                    </option>
                                {% endfor %}
                            </select>
                            {% if form.category.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.category.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Subcategory -->
                        <div id="subcategory-container">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Subcategory</label>
                            <select name="subcategory"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-select">
                                <option value="">Select Subcategory</option>
                                {% if form.subcategory.value %}
                                    <option value="{{ form.subcategory.value }}" selected>
                                        {% for subcategory in subcategories %}
                                            {% if subcategory.id|stringformat:"s" == form.subcategory.value|stringformat:"s" %}
                                                {{ subcategory.name }}
                                            {% endif %}
                                        {% endfor %}
                                    </option>
                                {% endif %}
                            </select>
                            {% if form.subcategory.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.subcategory.errors.0 }}</p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Navigation -->
                    <div class="flex justify-end mt-8 pt-6 border-t border-gray-100">
                        <button type="button" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-medium rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 shadow-sm hover:shadow-md next-step">
                            Next: Details <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Property Details -->
            <div class="step-content" id="step-2">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 md:p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Property Details</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Price -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Price <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500">₹</span>
                                </div>
                                <input type="number" name="price" step="0.01" min="1"
                                       class="w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-input"
                                       placeholder="0.00"
                                       required
                                       value="{{ form.price.value|default:'' }}">
                            </div>
                            {% if form.price.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.price.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Area -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Area <span class="text-red-500">*</span>
                            </label>
                            <div class="flex">
                                <input type="number" name="area" step="0.01" min="1"
                                       class="flex-1 rounded-l-lg border border-r-0 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 px-4 py-3 transition-all form-input"
                                       placeholder="e.g., 1500"
                                       required
                                       value="{{ form.area.value|default:'' }}">
                                <select name="area_unit"
                                        class="rounded-r-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 px-4 py-3 bg-gray-50 transition-all form-select">
                                    <option value="sqft" {% if form.area_unit.value == 'sqft' %}selected{% endif %}>Sq Ft</option>
                                    <option value="sqm" {% if form.area_unit.value == 'sqm' %}selected{% endif %}>Sq M</option>
                                    <option value="acre" {% if form.area_unit.value == 'acre' %}selected{% endif %}>Acres</option>
                                </select>
                            </div>
                            {% if form.area.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.area.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Bedrooms & Bathrooms -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Bedrooms</label>
                            <select name="bedrooms"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-select">
                                {% for i in "12345678910" %}
                                    <option value="{{ forloop.counter }}" {% if form.bedrooms.value|stringformat:"s" == forloop.counter|stringformat:"s" or forloop.counter == 3 and not form.bedrooms.value %}selected{% endif %}>
                                        {{ forloop.counter }} {{ forloop.counter|pluralize:"Bedroom,Bedrooms" }}
                                    </option>
                                {% endfor %}
                            </select>
                            {% if form.bedrooms.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.bedrooms.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Bathrooms</label>
                            <select name="bathrooms"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-select">
                                {% for i in "123456" %}
                                    <option value="{{ forloop.counter }}" {% if form.bathrooms.value|stringformat:"s" == forloop.counter|stringformat:"s" or forloop.counter == 2 and not form.bathrooms.value %}selected{% endif %}>
                                        {{ forloop.counter }} {{ forloop.counter|pluralize:"Bathroom,Bathrooms" }}
                                    </option>
                                {% endfor %}
                            </select>
                            {% if form.bathrooms.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.bathrooms.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Status & Furnishing -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status <span class="text-red-500">*</span></label>
                            <select name="status"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-select" required>
                                <option value="">Select Status</option>
                                <option value="for_sale" {% if form.status.value == 'for_sale' %}selected{% endif %}>For Sale</option>
                                <option value="for_rent" {% if form.status.value == 'for_rent' %}selected{% endif %}>For Rent</option>
                                <option value="pending" {% if form.status.value == 'pending' %}selected{% endif %}>Pending</option>
                                <option value="draft" {% if form.status.value == 'draft' %}selected{% endif %}>Draft</option>
                            </select>
                            {% if form.status.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.status.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Furnishing</label>
                            <select name="furnishing"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-select">
                                <option value="unfurnished" {% if form.furnishing.value == 'unfurnished' or not form.furnishing.value %}selected{% endif %}>Unfurnished</option>
                                <option value="semi_furnished" {% if form.furnishing.value == 'semi_furnished' %}selected{% endif %}>Semi-Furnished</option>
                                <option value="furnished" {% if form.furnishing.value == 'furnished' %}selected{% endif %}>Fully Furnished</option>
                            </select>
                            {% if form.furnishing.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.furnishing.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Additional Details -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Parking Spaces</label>
                            <select name="parking"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-select">
                                {% for i in "0123456789" %}
                                    <option value="{{ forloop.counter0 }}" {% if form.parking.value|stringformat:"s" == forloop.counter0|stringformat:"s" %}selected{% endif %}>
                                        {{ forloop.counter0 }} {{ forloop.counter0|pluralize:"Space,Spaces" }}
                                    </option>
                                {% endfor %}
                            </select>
                            {% if form.parking.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.parking.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Balconies</label>
                            <select name="balconies"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-select">
                                {% for i in "0123456" %}
                                    <option value="{{ forloop.counter0 }}" {% if form.balconies.value|stringformat:"s" == forloop.counter0|stringformat:"s" %}selected{% endif %}>
                                        {{ forloop.counter0 }} {{ forloop.counter0|pluralize:"Balcony,Balconies" }}
                                    </option>
                                {% endfor %}
                            </select>
                            {% if form.balconies.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.balconies.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Year Built -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Year Built</label>
                            <input type="number" name="year_built" min="1800" max="{% now "Y" %}"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-input"
                                   placeholder="e.g., 2015"
                                   value="{{ form.year_built.value|default:'' }}">
                            {% if form.year_built.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.year_built.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Condition -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Property Condition</label>
                            <select name="condition"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-select">
                                <option value="good" {% if form.condition.value == 'good' or not form.condition.value %}selected{% endif %}>Good</option>
                                <option value="excellent" {% if form.condition.value == 'excellent' %}selected{% endif %}>Excellent</option>
                                <option value="new" {% if form.condition.value == 'new' %}selected{% endif %}>New Construction</option>
                                <option value="needs_repair" {% if form.condition.value == 'needs_repair' %}selected{% endif %}>Needs Repair</option>
                                <option value="renovated" {% if form.condition.value == 'renovated' %}selected{% endif %}>Recently Renovated</option>
                            </select>
                            {% if form.condition.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.condition.errors.0 }}</p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Price Negotiable -->
                    <div class="mt-6">
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="checkbox" name="price_negotiable" 
                                   class="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                                   {% if form.price_negotiable.value %}checked{% endif %}>
                            <span class="ml-3 text-gray-700">Price is negotiable</span>
                        </label>
                    </div>

                    <!-- Navigation -->
                    <div class="flex justify-between mt-8 pt-6 border-t border-gray-100">
                        <button type="button" class="px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors shadow-sm hover:shadow prev-step">
                            <i class="fas fa-arrow-left mr-2"></i> Previous
                        </button>
                        <button type="button" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-medium rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 shadow-sm hover:shadow-md next-step">
                            Next: Location <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Location -->
            <div class="step-content" id="step-3">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 md:p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Location Details</h2>
                    
                    <div class="space-y-6">
                        <!-- Address -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Full Address <span class="text-red-500">*</span>
                            </label>
                            <textarea name="address" rows="3"
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-textarea"
                                      placeholder="Enter complete address including building name, floor, etc."
                                      required>{{ form.address.value|default:'' }}</textarea>
                            {% if form.address.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.address.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- City -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    City <span class="text-red-500">*</span>
                                </label>
                                <input type="text" name="city"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-input"
                                       placeholder="e.g., Mumbai"
                                       required
                                       value="{{ form.city.value|default:'' }}">
                                {% if form.city.errors %}
                                    <p class="text-red-500 text-sm mt-1">{{ form.city.errors.0 }}</p>
                                {% endif %}
                            </div>

                            <!-- Locality -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Locality/Area <span class="text-red-500">*</span>
                                </label>
                                <input type="text" name="locality"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-input"
                                       placeholder="e.g., Bandra West"
                                       required
                                       value="{{ form.locality.value|default:'' }}">
                                {% if form.locality.errors %}
                                    <p class="text-red-500 text-sm mt-1">{{ form.locality.errors.0 }}</p>
                                {% endif %}
                            </div>

                            <!-- Pincode -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Pincode</label>
                                <input type="text" name="pincode"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-input"
                                       placeholder="e.g., 400050"
                                       value="{{ form.pincode.value|default:'' }}">
                                {% if form.pincode.errors %}
                                    <p class="text-red-500 text-sm mt-1">{{ form.pincode.errors.0 }}</p>
                                {% endif %}
                            </div>

                            <!-- Landmark -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Landmark</label>
                                <input type="text" name="landmark"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-input"
                                       placeholder="e.g., Near Metro Station"
                                       value="{{ form.landmark.value|default:'' }}">
                                {% if form.landmark.errors %}
                                    <p class="text-red-500 text-sm mt-1">{{ form.landmark.errors.0 }}</p>
                                {% endif %}
                            </div>

                            <!-- State and Country -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
                                <input type="text" name="state"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-input"
                                       placeholder="e.g., Maharashtra"
                                       value="{{ form.state.value|default:'' }}">
                                {% if form.state.errors %}
                                    <p class="text-red-500 text-sm mt-1">{{ form.state.errors.0 }}</p>
                                {% endif %}
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Country</label>
                                <input type="text" name="country" value="{{ form.country.value|default:'India' }}"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-input">
                                {% if form.country.errors %}
                                    <p class="text-red-500 text-sm mt-1">{{ form.country.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Coordinates -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Latitude</label>
                                <input type="text" name="latitude" 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg form-input" 
                                       id="latitude"
                                       placeholder="e.g., 19.0760"
                                       value="{{ form.latitude.value|default:'' }}">
                                {% if form.latitude.errors %}
                                    <p class="text-red-500 text-sm mt-1">{{ form.latitude.errors.0 }}</p>
                                {% endif %}
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Longitude</label>
                                <input type="text" name="longitude"
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg form-input" 
                                       id="longitude"
                                       placeholder="e.g., 72.8777"
                                       value="{{ form.longitude.value|default:'' }}">
                                {% if form.longitude.errors %}
                                    <p class="text-red-500 text-sm mt-1">{{ form.longitude.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        <p class="text-sm text-gray-500">Coordinates are optional but help show your property on maps</p>
                    </div>

                    <!-- Navigation -->
                    <div class="flex justify-between mt-8 pt-6 border-t border-gray-100">
                        <button type="button" class="px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors shadow-sm hover:shadow prev-step">
                            <i class="fas fa-arrow-left mr-2"></i> Previous
                        </button>
                        <button type="button" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-medium rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 shadow-sm hover:shadow-md next-step">
                            Next: Media <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 4: Media -->
            <div class="step-content" id="step-4">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 md:p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Photos & Media</h2>
                    
                    <!-- Image Upload -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Property Images <span class="text-red-500">*</span>
                            <span class="text-sm text-gray-500 ml-2">(Upload 5-10 images, max 5MB each)</span>
                        </label>
                        
                        <div class="dropzone" id="dropzone">
                            <div class="py-12">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                                <p class="text-lg font-medium text-gray-700 mb-2">Drop images here or click to upload</p>
                                <p class="text-sm text-gray-500">PNG, JPG, WebP up to 5MB</p>
                                <input type="file" name="images" id="image-input" multiple 
                                       accept="image/*" class="hidden" required>
                                <button type="button" onclick="document.getElementById('image-input').click()" 
                                        class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-upload mr-2"></i> Browse Files
                                </button>
                            </div>
                        </div>
                        
                        <!-- Image Preview -->
                        <div class="image-preview" id="image-preview">
                            <div class="col-span-full text-center py-8 text-gray-500">
                                <i class="fas fa-images text-4xl mb-4"></i>
                                <p>No images uploaded yet</p>
                                <p class="text-sm mt-2">Uploaded images will appear here</p>
                            </div>
                        </div>
                        
                        <!-- Existing Images (for edit) -->
                        {% if existing_images %}
                        <div class="mt-6">
                            <h4 class="text-lg font-semibold text-gray-900 mb-3">Existing Images</h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                {% for image in existing_images %}
                                <div class="relative">
                                    <img src="{{ image.image.url }}" alt="Property Image" class="w-full h-32 object-cover rounded-lg">
                                    <div class="absolute top-2 right-2">
                                        <input type="checkbox" name="delete_images" value="{{ image.id }}" class="rounded border-gray-300 text-red-600 focus:ring-red-500">
                                    </div>
                                    {% if image.is_primary %}
                                    <span class="absolute top-2 left-2 bg-green-600 text-white text-xs px-2 py-1 rounded">Primary</span>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        <div class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                            <div class="flex items-start">
                                <i class="fas fa-info-circle text-blue-600 mt-1 mr-3"></i>
                                <div class="text-sm text-gray-700">
                                    <p class="font-medium">Tips for great property photos:</p>
                                    <ul class="mt-2 space-y-1">
                                        <li>• Use high-quality, well-lit photos</li>
                                        <li>• First image will be set as primary cover photo</li>
                                        <li>• Include photos of all rooms, exterior, and amenities</li>
                                        <li>• Drag to reorder images</li>
                                        <li>• Click on any image to set as primary</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Virtual Tour & Video -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Virtual Tour URL</label>
                            <input type="url" name="virtual_tour"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-input"
                                   placeholder="https://..."
                                   value="{{ form.virtual_tour.value|default:'' }}">
                            <p class="text-sm text-gray-500 mt-2">YouTube, Matterport, or other virtual tour link</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Property Video URL</label>
                            <input type="url" name="video_url"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-input"
                                   placeholder="https://..."
                                   value="{{ form.video_url.value|default:'' }}">
                            <p class="text-sm text-gray-500 mt-2">YouTube or Vimeo link showcasing your property</p>
                        </div>
                    </div>

                    <!-- Floor Plan -->
                    <div class="mt-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Floor Plan Image</label>
                        {% if form.instance.floor_plan %}
                        <div class="mb-3">
                            <p class="text-sm text-gray-600 mb-2">Current floor plan:</p>
                            <img src="{{ form.instance.floor_plan.url }}" alt="Floor Plan" class="w-48 h-48 object-contain border rounded-lg">
                            <div class="mt-2">
                                <label class="inline-flex items-center">
                                    <input type="checkbox" name="clear_floor_plan" class="rounded border-gray-300 text-red-600 focus:ring-red-500">
                                    <span class="ml-2 text-sm text-gray-700">Remove current floor plan</span>
                                </label>
                            </div>
                        </div>
                        {% endif %}
                        <input type="file" name="floor_plan" accept="image/*"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-input">
                        <p class="text-sm text-gray-500 mt-2">Upload a floor plan image (optional)</p>
                    </div>

                    <!-- Navigation -->
                    <div class="flex justify-between mt-8 pt-6 border-t border-gray-100">
                        <button type="button" class="px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors shadow-sm hover:shadow prev-step">
                            <i class="fas fa-arrow-left mr-2"></i> Previous
                        </button>
                        <button type="button" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-medium rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 shadow-sm hover:shadow-md next-step">
                            Next: Review <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 5: Review & Amenities -->
            <div class="step-content" id="step-5">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 md:p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Review & Finalize</h2>
                    
                    <!-- Property Summary -->
                    <div class="mb-8 p-6 bg-gray-50 rounded-xl border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Property Summary</h3>
                        <div id="property-summary" class="space-y-3">
                            <!-- Summary will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Amenities -->
                    <div class="mb-8">
                        <label class="block text-lg font-semibold text-gray-900 mb-4">Select Amenities</label>
                        {% if amenities %}
                        <div class="amenity-grid">
                            {% for amenity in amenities %}
                                <label class="amenity-item {% if amenity.id|stringformat:'s' in form.amenities.value %}selected{% endif %}">
                                    <input type="checkbox" name="amenities" value="{{ amenity.id }}" 
                                           class="amenity-checkbox"
                                           {% if amenity.id|stringformat:'s' in form.amenities.value %}checked{% endif %}>
                                    <div class="flex items-center">
                                        {% if amenity.icon %}
                                            <i class="{{ amenity.icon }} text-blue-600 mr-3 text-lg"></i>
                                        {% else %}
                                            <i class="fas fa-check-circle text-blue-600 mr-3 text-lg"></i>
                                        {% endif %}
                                        <span class="text-gray-700">{{ amenity.name }}</span>
                                    </div>
                                </label>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-4 text-gray-500">
                            <i class="fas fa-exclamation-circle text-2xl mb-2"></i>
                            <p>No amenities available. Please add amenities in the admin panel.</p>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Contact Information -->
                    <div class="border-t border-gray-200 pt-8">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Contact Information</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Contact Person</label>
                                <input type="text" name="contact_person"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-input"
                                       placeholder="Your name"
                                       value="{{ form.contact_person.value|default:user.get_full_name|default:'' }}">
                                {% if form.contact_person.errors %}
                                    <p class="text-red-500 text-sm mt-1">{{ form.contact_person.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Contact Email <span class="text-red-500">*</span>
                                </label>
                                <input type="email" name="contact_email" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-input"
                                       required
                                       value="{{ form.contact_email.value|default:user.email }}">
                                {% if form.contact_email.errors %}
                                    <p class="text-red-500 text-sm mt-1">{{ form.contact_email.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Contact Phone</label>
                                <input type="tel" name="contact_phone"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-input"
                                       placeholder="+91 9876543210"
                                       value="{{ form.contact_phone.value|default:user.phone|default:'' }}">
                                {% if form.contact_phone.errors %}
                                    <p class="text-red-500 text-sm mt-1">{{ form.contact_phone.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Listed By</label>
                                <select name="listing_type"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-select">
                                    <option value="owner" {% if form.listing_type.value == 'owner' or not form.listing_type.value %}selected{% endif %}>Owner</option>
                                    <option value="agent" {% if form.listing_type.value == 'agent' %}selected{% endif %}>Agent/Broker</option>
                                    <option value="builder" {% if form.listing_type.value == 'builder' %}selected{% endif %}>Builder</option>
                                </select>
                                {% if form.listing_type.errors %}
                                    <p class="text-red-500 text-sm mt-1">{{ form.listing_type.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Additional Features -->
                    <div class="border-t border-gray-200 pt-8">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Additional Features</h3>
                        <div class="space-y-4">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                <input type="checkbox" name="rera_registered" 
                                       class="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                                       {% if form.rera_registered.value %}checked{% endif %}>
                                <span class="ml-3 text-gray-700">RERA Registered</span>
                            </label>
                            
                            <div id="rera-number-container" class="{% if not form.rera_registered.value %}hidden{% endif %} mt-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">RERA Number (If Registered)</label>
                                <input type="text" name="rera_number"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-input"
                                       placeholder="RERA registration number"
                                       value="{{ form.rera_number.value|default:'' }}">
                                {% if form.rera_number.errors %}
                                    <p class="text-red-500 text-sm mt-1">{{ form.rera_number.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            {% if form.status.value == 'for_rent' %}
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Security Deposit (For Rent)</label>
                                <input type="number" name="security_deposit" step="0.01" min="0"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all form-input"
                                       placeholder="0.00"
                                       value="{{ form.security_deposit.value|default:'' }}">
                                {% if form.security_deposit.errors %}
                                    <p class="text-red-500 text-sm mt-1">{{ form.security_deposit.errors.0 }}</p>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Preview & Submit -->
                    <div class="border-t border-gray-200 pt-8 mt-8">
                        <div class="flex flex-col md:flex-row md:items-center justify-between">
                            <div>
                                <h4 class="text-lg font-semibold text-gray-900 mb-2">Ready to List?</h4>
                                <p class="text-gray-600">Review all details before submitting. You can edit after listing.</p>
                            </div>
                            
                            <div class="mt-4 md:mt-0 flex flex-col sm:flex-row gap-4">
                                <button type="button" class="px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors shadow-sm hover:shadow prev-step">
                                    <i class="fas fa-edit mr-2"></i> Edit Details
                                </button>
                                <button type="submit" class="px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white font-medium rounded-lg hover:from-green-700 hover:to-emerald-700 transition-all duration-300 shadow-md hover:shadow-lg flex items-center justify-center" id="submit-button">
                                    <i class="fas fa-paper-plane mr-2"></i> List Property
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <!-- Help Section -->
        <div class="mt-12 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-8 border border-blue-200">
            <div class="flex flex-col md:flex-row md:items-center">
                <div class="flex-1">
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Need Help Listing?</h3>
                    <p class="text-gray-700 mb-4">Our team is here to assist you with creating the perfect property listing.</p>
                    <div class="flex flex-wrap gap-4">
                        <a href="{% url 'how_to_list' %}" class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium">
                            <i class="fas fa-book mr-2"></i> Listing Guide
                        </a>
                        <a href="{% url 'pricing_guide' %}" class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium">
                            <i class="fas fa-dollar-sign mr-2"></i> Pricing Guide
                        </a>
                        <a href="{% url 'contact' %}" class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium">
                            <i class="fas fa-headset mr-2"></i> Contact Support
                        </a>
                    </div>
                </div>
                <div class="mt-6 md:mt-0 md:ml-8">
                    <div class="animate-float inline-block">
                        <div class="w-20 h-20 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full flex items-center justify-center shadow-lg">
                            <i class="fas fa-hands-helping text-white text-3xl"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-12 bg-gray-900 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center mb-4">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-home text-white text-xl"></i>
                        </div>
                        <span class="text-xl font-bold">RealEstatePro</span>
                    </div>
                    <p class="text-gray-400 text-sm">Find your dream property or list your property with us.</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Quick Links</h4>
                    <ul class="space-y-2">
                        <li><a href="{% url 'list' %}" class="text-gray-400 hover:text-white transition-colors">Browse Properties</a></li>
                        <li><a href="{% url 'pricing' %}" class="text-gray-400 hover:text-white transition-colors">Pricing</a></li>
                        <li><a href="{% url 'how_to_list' %}" class="text-gray-400 hover:text-white transition-colors">How to List</a></li>
                        <li><a href="{% url 'features' %}" class="text-gray-400 hover:text-white transition-colors">Features</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Company</h4>
                    <ul class="space-y-2">
                        <li><a href="{% url 'about' %}" class="text-gray-400 hover:text-white transition-colors">About Us</a></li>
                        <li><a href="{% url 'contact' %}" class="text-gray-400 hover:text-white transition-colors">Contact</a></li>
                        <li><a href="{% url 'faq' %}" class="text-gray-400 hover:text-white transition-colors">FAQ</a></li>
                        <li><a href="{% url 'privacy' %}" class="text-gray-400 hover:text-white transition-colors">Privacy Policy</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Connect</h4>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fab fa-facebook text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fab fa-twitter text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fab fa-instagram text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fab fa-linkedin text-xl"></i>
                        </a>
                    </div>
                    <p class="text-gray-400 text-sm mt-4">Subscribe to our newsletter</p>
                    <form class="mt-2">
                        <div class="flex">
                            <input type="email" placeholder="Your email" class="flex-1 px-3 py-2 text-gray-900 rounded-l-lg focus:outline-none">
                            <button type="submit" class="bg-blue-600 px-4 py-2 rounded-r-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; {% now "Y" %} RealEstatePro. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        (function() {
            'use strict';
            
            // Property Creation Form JavaScript
            // This is wrapped in IIFE to prevent variable conflicts
            
            // Multi-step form functionality
            let currentStep = 1;
            const totalSteps = 5;
            
            // Image upload functionality
            let images = [];
            let primaryIndex = 0;
            let imageInput = null;
            let dropzone = null;
            let imagePreview = null;
            
            function showStep(step) {
                console.log(`Showing step ${step}`);
                
                // Hide all steps
                document.querySelectorAll('.step-content').forEach(el => {
                    el.classList.remove('active');
                });
                
                // Show current step
                const stepElement = document.getElementById(`step-${step}`);
                if (stepElement) {
                    stepElement.classList.add('active');
                }
                
                // Update step indicators
                document.querySelectorAll('.step').forEach((el, index) => {
                    const stepNumber = index + 1;
                    el.classList.remove('active', 'completed');
                    
                    if (stepNumber === step) {
                        el.classList.add('active');
                    } else if (stepNumber < step) {
                        el.classList.add('completed');
                    }
                });
                
                currentStep = step;
                
                // Update property summary in step 5
                if (step === 5) {
                    updatePropertySummary();
                }
                
                // Scroll to top of form for better UX
                if (stepElement) {
                    stepElement.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                }
            }
            
            // Navigation buttons
            document.querySelectorAll('.next-step').forEach(button => {
                button.addEventListener('click', () => {
                    console.log(`Next button clicked from step ${currentStep}`);
                    if (currentStep < totalSteps && validateStep(currentStep)) {
                        showStep(currentStep + 1);
                    }
                });
            });
            
            document.querySelectorAll('.prev-step').forEach(button => {
                button.addEventListener('click', () => {
                    console.log(`Previous button clicked from step ${currentStep}`);
                    if (currentStep > 1) {
                        showStep(currentStep - 1);
                    }
                });
            });
            
            function syncImagesToForm() {
                if (!imageInput) return;
                
                const dataTransfer = new DataTransfer();
                images.forEach(img => {
                    if (img.file) {
                        dataTransfer.items.add(img.file);
                    }
                });
                imageInput.files = dataTransfer.files;
                console.log('Synced images to form:', imageInput.files.length);
            }
            
            function validateStep(step) {
                console.log(`=== Validating Step ${step} ===`);
                
                // Sync images before checking Step 4 or 5
                if (step === 4 || step === 5) {
                    syncImagesToForm();
                }
                
                switch(step) {
                    case 1:
                        const title = document.querySelector('input[name="title"]');
                        const description = document.querySelector('textarea[name="description"]');
                        const category = document.querySelector('select[name="category"]');
                        
                        console.log('Title:', title?.value);
                        console.log('Description:', description?.value);
                        console.log('Category:', category?.value);
                        
                        if (!title?.value?.trim()) {
                            showToast('Please enter a property title', 'error');
                            title?.focus();
                            return false;
                        }
                        if (!description?.value?.trim()) {
                            showToast('Please enter a property description', 'error');
                            description?.focus();
                            return false;
                        }
                        if (!category?.value) {
                            showToast('Please select a property category', 'error');
                            category?.focus();
                            return false;
                        }
                        console.log('Step 1 Validation: PASSED');
                        return true;
                        
                    case 2:
                        const price = document.querySelector('input[name="price"]');
                        const area = document.querySelector('input[name="area"]');
                        const status = document.querySelector('select[name="status"]');
                        
                        console.log('Price:', price?.value);
                        console.log('Area:', area?.value);
                        console.log('Status:', status?.value);
                        
                        if (!price?.value || parseFloat(price.value) <= 0) {
                            showToast('Please enter a valid price (greater than 0)', 'error');
                            price?.focus();
                            return false;
                        }
                        if (!area?.value || parseFloat(area.value) <= 0) {
                            showToast('Please enter a valid area (greater than 0)', 'error');
                            area?.focus();
                            return false;
                        }
                        if (!status?.value) {
                            showToast('Please select a property status', 'error');
                            status?.focus();
                            return false;
                        }
                        console.log('Step 2 Validation: PASSED');
                        return true;
                        
                    case 3:
                        const address = document.querySelector('textarea[name="address"]');
                        const city = document.querySelector('input[name="city"]');
                        const locality = document.querySelector('input[name="locality"]');
                        
                        console.log('Address:', address?.value);
                        console.log('City:', city?.value);
                        console.log('Locality:', locality?.value);
                        
                        if (!address?.value?.trim()) {
                            showToast('Please enter the property address', 'error');
                            address?.focus();
                            return false;
                        }
                        if (!city?.value?.trim()) {
                            showToast('Please enter the city', 'error');
                            city?.focus();
                            return false;
                        }
                        if (!locality?.value?.trim()) {
                            showToast('Please enter the locality/area', 'error');
                            locality?.focus();
                            return false;
                        }
                        console.log('Step 3 Validation: PASSED');
                        return true;
                        
                    case 4:
                        console.log('Images Array Length:', images.length);
                        console.log('File Input Files Length:', imageInput?.files?.length);
                        
                        // Check if there are existing images (for edit) or new images
                        const existingImagesCount = document.querySelectorAll('input[name="delete_images"]:not(:checked)').length;
                        const hasExistingImages = existingImagesCount > 0;
                        
                        if (images.length === 0 && !hasExistingImages) {
                            showToast('Please upload at least one property image', 'error');
                            // Visual feedback
                            if (dropzone) {
                                dropzone.style.borderColor = '#ef4444';
                                dropzone.style.backgroundColor = '#fef2f2';
                                setTimeout(() => {
                                    dropzone.style.borderColor = '';
                                    dropzone.style.backgroundColor = '';
                                }, 2000);
                            }
                            return false;
                        }
                        console.log('Step 4 Validation: PASSED');
                        return true;
                        
                    case 5:
                        const contactEmail = document.querySelector('input[name="contact_email"]');
                        console.log('Contact Email:', contactEmail?.value);
                        
                        if (!contactEmail?.value?.trim()) {
                            showToast('Please enter a contact email', 'error');
                            contactEmail?.focus();
                            return false;
                        }
                        
                        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                        if (!emailRegex.test(contactEmail.value.trim())) {
                            showToast('Please enter a valid email address', 'error');
                            contactEmail?.focus();
                            return false;
                        }
                        console.log('Step 5 Validation: PASSED');
                        return true;
                        
                    default:
                        console.log('Step Validation: DEFAULT CASE');
                        return true;
                }
            }
            
            function handleImageFiles(files) {
                console.log('Handling image files:', files.length);
                
                let validFiles = [];
                let errorMessages = [];
                
                files.forEach(file => {
                    if (!file.type.startsWith('image/')) {
                        errorMessages.push(`${file.name} is not an image file`);
                        return;
                    }
                    
                    if (file.size > 5 * 1024 * 1024) {
                        errorMessages.push(`${file.name} exceeds 5MB limit`);
                        return;
                    }
                    
                    validFiles.push(file);
                });
                
                if (errorMessages.length > 0) {
                    showToast('Some files were rejected:\n' + errorMessages.join('\n'), 'error');
                }
                
                validFiles.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        images.push({
                            file: file,
                            preview: e.target.result,
                            isPrimary: images.length === 0
                        });
                        updateImagePreview();
                    };
                    reader.readAsDataURL(file);
                });
            }
            
            function updateImagePreview() {
                if (!imagePreview) return;
                
                imagePreview.innerHTML = '';
                
                if (images.length === 0) {
                    imagePreview.innerHTML = `
                        <div class="col-span-full text-center py-8 text-gray-500">
                            <i class="fas fa-images text-4xl mb-4"></i>
                            <p>No images uploaded yet</p>
                            <p class="text-sm mt-2">Uploaded images will appear here</p>
                        </div>
                    `;
                    return;
                }
                
                images.forEach((img, index) => {
                    const div = document.createElement('div');
                    div.className = 'preview-item';
                    div.innerHTML = `
                        <img src="${img.preview}" alt="Preview">
                        ${img.isPrimary ? '<div class="primary-badge">Primary</div>' : ''}
                        <div class="remove-btn" data-index="${index}" title="Remove image">
                            <i class="fas fa-times"></i>
                        </div>
                    `;
                    
                    div.addEventListener('click', (e) => {
                        if (!e.target.closest('.remove-btn')) {
                            setPrimaryImage(index);
                        }
                    });
                    
                    div.querySelector('.remove-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        removeImage(index);
                    });
                    
                    imagePreview.appendChild(div);
                });
                
                if (dropzone) {
                    dropzone.style.borderColor = '';
                    dropzone.style.backgroundColor = '';
                }
            }
            
            function removeImage(index) {
                images.splice(index, 1);
                if (images.length > 0 && index === primaryIndex) {
                    images[0].isPrimary = true;
                    primaryIndex = 0;
                }
                updateImagePreview();
            }
            
            function setPrimaryImage(index) {
                images.forEach((img, i) => {
                    img.isPrimary = i === index;
                });
                primaryIndex = index;
                updateImagePreview();
            }
            
            // Amenity selection
            document.querySelectorAll('.amenity-item').forEach(item => {
                item.addEventListener('click', () => {
                    const checkbox = item.querySelector('.amenity-checkbox');
                    checkbox.checked = !checkbox.checked;
                    item.classList.toggle('selected', checkbox.checked);
                });
            });
            
            // Update property summary in step 5
            function updatePropertySummary() {
                const summaryContainer = document.getElementById('property-summary');
                if (!summaryContainer) return;
                
                let summaryHTML = '';
                
                try {
                    const title = document.querySelector('input[name="title"]')?.value || 'Not provided';
                    const categorySelect = document.querySelector('select[name="category"]');
                    const category = categorySelect?.options[categorySelect.selectedIndex]?.text || 'Not provided';
                    const price = document.querySelector('input[name="price"]')?.value ? 
                                  `₹${parseFloat(document.querySelector('input[name="price"]').value).toLocaleString()}` : 'Not provided';
                    const area = document.querySelector('input[name="area"]')?.value ? 
                                 `${document.querySelector('input[name="area"]').value} ${document.querySelector('select[name="area_unit"]')?.value || 'sqft'}` : 'Not provided';
                    const bedrooms = document.querySelector('select[name="bedrooms"]')?.value || 'Not provided';
                    const bathrooms = document.querySelector('select[name="bathrooms"]')?.value || 'Not provided';
                    const city = document.querySelector('input[name="city"]')?.value || 'Not provided';
                    const locality = document.querySelector('input[name="locality"]')?.value || 'Not provided';
                    const address = document.querySelector('textarea[name="address"]')?.value || 'Not provided';
                    const imagesCount = images.length;
                    
                    summaryHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-600">Title</p>
                                <p class="font-medium">${title}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Category</p>
                                <p class="font-medium">${category}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Price</p>
                                <p class="font-medium">${price}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Area</p>
                                <p class="font-medium">${area}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Bedrooms</p>
                                <p class="font-medium">${bedrooms}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Bathrooms</p>
                                <p class="font-medium">${bathrooms}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Location</p>
                                <p class="font-medium">${city}, ${locality}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Images Uploaded</p>
                                <p class="font-medium">${imagesCount} image${imagesCount !== 1 ? 's' : ''}</p>
                            </div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <p class="text-sm text-gray-600 mb-1">Address</p>
                            <p class="font-medium">${address.substring(0, 100)}${address.length > 100 ? '...' : ''}</p>
                        </div>
                    `;
                } catch (error) {
                    console.error('Error generating summary:', error);
                    summaryHTML = '<p class="text-red-600">Error loading summary. Please check your form data.</p>';
                }
                
                summaryContainer.innerHTML = summaryHTML;
            }
            
            // Toast notification system
            function showToast(message, type = 'info') {
                const container = document.getElementById('toast-container');
                if (!container) return;
                
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} mr-3"></i>
                            <span>${message}</span>
                        </div>
                        <button class="ml-4 text-white hover:text-gray-200" onclick="this.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(toast);
                
                setTimeout(() => {
                    toast.classList.add('show');
                }, 10);
                
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, 5000);
            }
            
            // RERA number toggle
            const reraCheckbox = document.querySelector('input[name="rera_registered"]');
            const reraContainer = document.getElementById('rera-number-container');
            
            if (reraCheckbox && reraContainer) {
                reraCheckbox.addEventListener('change', function() {
                    if (this.checked) {
                        reraContainer.classList.remove('hidden');
                    } else {
                        reraContainer.classList.add('hidden');
                    }
                });
            }
            
            // Mobile menu toggle
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }
            
            // Close mobile menu when clicking outside
            document.addEventListener('click', (e) => {
                if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
                    if (!mobileMenu.contains(e.target) && !mobileMenuButton.contains(e.target)) {
                        mobileMenu.classList.add('hidden');
                    }
                }
            });
            
            // Initialize everything
            function initPropertyForm() {
                console.log('Initializing property form...');
                
                // Get DOM elements
                dropzone = document.getElementById('dropzone');
                imageInput = document.getElementById('image-input');
                imagePreview = document.getElementById('image-preview');
                
                // Initialize image upload
                if (dropzone) {
                    dropzone.addEventListener('click', (e) => {
                        if (e.target.closest('button')) return;
                        imageInput.click();
                    });
                    
                    dropzone.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        dropzone.classList.add('dragover');
                    });
                    
                    dropzone.addEventListener('dragleave', () => {
                        dropzone.classList.remove('dragover');
                    });
                    
                    dropzone.addEventListener('drop', (e) => {
                        e.preventDefault();
                        dropzone.classList.remove('dragover');
                        const files = Array.from(e.dataTransfer.files);
                        handleImageFiles(files);
                    });
                }
                
                if (imageInput) {
                    imageInput.addEventListener('change', (e) => {
                        const files = Array.from(e.target.files);
                        handleImageFiles(files);
                    });
                }
                
                // Initialize image preview
                updateImagePreview();
                
                // Form submission
                const propertyForm = document.getElementById('property-form');
                if (propertyForm) {
                    propertyForm.addEventListener('submit', function(e) {
                        console.log('=== FORM SUBMISSION STARTED ===');
                        
                        // Validate all steps
                        let allValid = true;
                        let firstInvalidStep = 1;
                        
                        for (let step = 1; step <= totalSteps; step++) {
                            if (!validateStep(step)) {
                                console.log(`Step ${step} validation FAILED`);
                                allValid = false;
                                firstInvalidStep = step;
                                break;
                            }
                        }
                        
                        if (!allValid) {
                            e.preventDefault();
                            console.log(`Form invalid. Showing step ${firstInvalidStep}`);
                            showStep(firstInvalidStep);
                            showToast('Please fix all errors before submitting', 'error');
                            return false;
                        }
                        
                        console.log('All validation passed. Submitting form...');
                        
                        // Show loading state
                        const submitBtn = this.querySelector('button[type="submit"]');
                        if (submitBtn) {
                            submitBtn.disabled = true;
                            submitBtn.innerHTML = '<div class="spinner mr-2"></div> Creating Property...';
                            
                            // Re-enable after 10 seconds (in case submission fails)
                            setTimeout(() => {
                                submitBtn.disabled = false;
                                submitBtn.innerHTML = '<i class="fas fa-paper-plane mr-2"></i> List Property';
                            }, 10000);
                        }
                        
                        // Allow form to submit normally
                        return true;
                    });
                }
                
                // Handle HTMX requests for subcategories
                document.body.addEventListener('htmx:afterRequest', function(event) {
                    if (event.detail.elt.id === 'subcategory-container') {
                        // Subcategories loaded successfully
                        console.log('Subcategories loaded');
                    }
                });
                
                console.log('Property form initialized successfully');
            }
            
            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initPropertyForm);
            } else {
                initPropertyForm();
            }
            
        })();  // End of IIFE
    </script>
</body>
</html>