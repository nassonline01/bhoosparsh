<!-- Inquiry List Widget -->
<div class="card h-100">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0"><i class="fas fa-envelope me-2"></i> Recent Inquiries</h5>
        <span class="badge bg-primary">{{ stats.engagement_stats.total_inquiries|default:0 }}</span>
    </div>
    <div class="card-body p-0">
        <div class="list-group list-group-flush">
            {% for inquiry in recent_inquiries|slice:":5" %}
            <div class="list-group-item list-group-item-action border-start-0 border-end-0 py-3">
                <div class="d-flex align-items-start">
                    <div class="flex-shrink-0">
                        {% if inquiry.user and inquiry.user.profile.avatar %}
                        <img src="{{ inquiry.user.profile.avatar.url }}" 
                             class="rounded-circle" 
                             width="40" 
                             height="40"
                             alt="{{ inquiry.inquirer_name }}">
                        {% else %}
                        <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center" 
                             style="width: 40px; height: 40px;">
                            {{ inquiry.inquirer_name|first|upper }}
                        </div>
                        {% endif %}
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">{{ inquiry.inquirer_name }}</h6>
                                <p class="mb-1 small text-muted">
                                    <i class="fas fa-home me-1"></i>
                                    {{ inquiry.property_link.title|truncatechars:30 }}
                                </p>
                            </div>
                            <span class="badge bg-{{ inquiry.status|inquiry_status_color }}">
                                {{ inquiry.get_status_display }}
                            </span>
                        </div>
                        <p class="mb-2 small">{{ inquiry.message|truncatechars:80 }}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">
                                <i class="fas fa-clock me-1"></i>
                                {{ inquiry.created_at|timesince }} ago
                            </small>
                            <div class="btn-group btn-group-sm">
                                <button type="button" 
                                        class="btn btn-outline-primary"
                                        data-bs-toggle="modal" 
                                        data-bs-target="#inquiryModal{{ inquiry.id }}">
                                    <i class="fas fa-reply"></i>
                                </button>
                                <a href="{% url 'properties:detail' inquiry.property_link.slug %}" 
                                   class="btn btn-outline-secondary">
                                    <i class="fas fa-eye"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Inquiry Response Modal -->
            <div class="modal fade" id="inquiryModal{{ inquiry.id }}" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Respond to Inquiry</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <strong>Property:</strong> {{ inquiry.property_link.title }}<br>
                                <strong>Inquirer:</strong> {{ inquiry.inquirer_name }}<br>
                                <strong>Email:</strong> {{ inquiry.inquirer_email }}<br>
                                <strong>Phone:</strong> {{ inquiry.phone }}<br>
                                <strong>Message:</strong><br>
                                <p class="mt-2">{{ inquiry.message }}</p>
                            </div>
                            
                            {% if inquiry.response %}
                            <div class="alert alert-info">
                                <strong>Previous Response:</strong><br>
                                {{ inquiry.response }}
                                <small class="d-block mt-2 text-muted">
                                    Responded on {{ inquiry.responded_at|date:"M d, Y h:i A" }}
                                </small>
                            </div>
                            {% endif %}
                            
                            <form method="post" action="{% url 'core:respond_inquiry' inquiry.id %}">
                                {% csrf_token %}
                                <div class="mb-3">
                                    <label for="response{{ inquiry.id }}" class="form-label">Your Response</label>
                                    <textarea class="form-control" 
                                              id="response{{ inquiry.id }}" 
                                              name="response" 
                                              rows="4" 
                                              required
                                              placeholder="Type your response here...">{{ inquiry.response|default:'' }}</textarea>
                                </div>
                                <div class="d-flex justify-content-end gap-2">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                        Cancel
                                    </button>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-paper-plane me-1"></i> Send Response
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="text-center py-5">
                <div class="text-muted">
                    <i class="fas fa-envelope fa-2x mb-3"></i><br>
                    No inquiries yet
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- View All Link -->
        {% if recent_inquiries %}
        <div class="text-center py-3 border-top">
            <a href="#" class="btn btn-sm btn-outline-primary">
                View All Inquiries <i class="fas fa-arrow-right ms-1"></i>
            </a>
        </div>
        {% endif %}
    </div>
    
    <!-- Inquiry Stats -->
    {% if recent_inquiries %}
    <div class="card-footer">
        <div class="row text-center">
            <div class="col-3">
                <div class="text-primary">{{ stats.engagement_stats.new_inquiries|default:0 }}</div>
                <small class="text-muted">New</small>
            </div>
            <div class="col-3">
                <div class="text-success">{{ stats.engagement_stats.converted_inquiries|default:0 }}</div>
                <small class="text-muted">Converted</small>
            </div>
            <div class="col-3">
                <div class="text-warning">{{ stats.engagement_stats.total_inquiries|default:0 }}</div>
                <small class="text-muted">Total</small>
            </div>
            <div class="col-3">
                <div class="text-info">{{ stats.performance_stats.response_rate|default:0|floatformat:1 }}%</div>
                <small class="text-muted">Response Rate</small>
            </div>
        </div>
    </div>
    {% endif %}
</div>