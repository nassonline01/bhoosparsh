{% extends 'dashboard/seller/base.html' %}
{% load static %}

{% block title %}BHOOSPARSH - Create New Property{% endblock %}

{% block extra_css %}
<style>
    /* Create Property Specific Styles */
    .step-indicator {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .step {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        position: relative;
        min-width: 100px;
    }

    .step-number {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        z-index: 1;
        transition: all 0.3s ease;
    }

    .step.active .step-number {
        background: linear-gradient(135deg, #0E68B9 0%, #1a7fd8 100%);
        color: white;
        transform: scale(1.1);
        box-shadow: 0 4px 15px rgba(14, 104, 185, 0.3);
    }

    .step.inactive .step-number {
        background-color: #e5e7eb;
        color: #6b7280;
        border: 2px solid #d1d5db;
    }

    .step.completed .step-number {
        background: linear-gradient(135deg, #10B981 0%, #34D399 100%);
        color: white;
    }

    .step-line {
        position: absolute;
        top: 20px;
        left: 50%;
        width: calc(100% + 2rem);
        height: 2px;
        background-color: #e5e7eb;
        z-index: 0;
    }

    .step-title {
        font-size: 0.75rem;
        font-weight: 500;
        color: #6b7280;
        text-align: center;
    }

    .step.active .step-title {
        color: #0E68B9;
        font-weight: 600;
    }

    .step-content {
        display: none;
        animation: fadeIn 0.5s ease-out;
    }

    .step-content.active {
        display: block;
    }

    /* Form Enhancements */
    .form-card {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
    }

    .dark .form-card {
        background: #1f2937;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }

    .form-card:hover {
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
    }

    .form-label {
        display: block;
        font-weight: 500;
        color: #374151;
        margin-bottom: 0.5rem;
        font-size: 0.875rem;
    }

    .dark .form-label {
        color: #d1d5db;
    }

    .form-input, .form-select, .form-textarea {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        background: white;
        color: #374151;
        font-size: 0.875rem;
        transition: all 0.3s ease;
    }

    .dark .form-input, .dark .form-select, .dark .form-textarea {
        background: #374151;
        border-color: #4b5563;
        color: #f9fafb;
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
        outline: none;
        border-color: #0E68B9;
        box-shadow: 0 0 0 3px rgba(14, 104, 185, 0.1);
    }

    .form-textarea {
        min-height: 120px;
        resize: vertical;
    }

    /* Amenities Grid */
    .amenities-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
    }

    .amenity-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem;
        background: #f9fafb;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .dark .amenity-item {
        background: #374151;
        border-color: #4b5563;
    }

    .amenity-item:hover {
        border-color: #0E68B9;
        background: #f0f9ff;
    }

    .dark .amenity-item:hover {
        background: #1e40af20;
    }

    .amenity-item.selected {
        border-color: #0E68B9;
        background: #f0f9ff;
        box-shadow: 0 2px 10px rgba(14, 104, 185, 0.1);
    }

    .dark .amenity-item.selected {
        background: #1e40af20;
    }

    .amenity-checkbox {
        width: 20px;
        height: 20px;
        border: 2px solid #d1d5db;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }

    .amenity-item.selected .amenity-checkbox {
        background: #0E68B9;
        border-color: #0E68B9;
    }

    .amenity-checkbox svg {
        width: 12px;
        height: 12px;
        color: white;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .amenity-item.selected .amenity-checkbox svg {
        opacity: 1;
    }

    /* Image Upload */
    .image-upload-area {
        border: 2px dashed #d1d5db;
        border-radius: 12px;
        padding: 3rem 2rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background: #f9fafb;
    }

    .dark .image-upload-area {
        background: #374151;
        border-color: #4b5563;
    }

    .image-upload-area:hover {
        border-color: #0E68B9;
        background: #f0f9ff;
    }

    .dark .image-upload-area:hover {
        background: #1e40af20;
    }

    .image-upload-area.dragover {
        border-color: #0E68B9;
        background: #f0f9ff;
        transform: scale(1.02);
    }

    .dark .image-upload-area.dragover {
        background: #1e40af20;
    }

    .image-preview {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }

    .image-preview-item {
        position: relative;
        border-radius: 8px;
        overflow: hidden;
        height: 150px;
    }

    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .image-remove-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        width: 28px;
        height: 28px;
        background: rgba(239, 68, 68, 0.9);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .image-remove-btn:hover {
        background: rgba(220, 38, 38, 1);
        transform: scale(1.1);
    }

    /* Navigation Buttons */
    .form-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 1px solid #e5e7eb;
    }

    .dark .form-navigation {
        border-color: #4b5563;
    }

    .btn {
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-weight: 500;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-prev {
        background: #f3f4f6;
        color: #374151;
        border: 2px solid #d1d5db;
    }

    .dark .btn-prev {
        background: #374151;
        color: #d1d5db;
        border-color: #4b5563;
    }

    .btn-prev:hover {
        background: #e5e7eb;
        border-color: #9ca3af;
    }

    .dark .btn-prev:hover {
        background: #4b5563;
        border-color: #6b7280;
    }

    .btn-next, .btn-submit {
        background: linear-gradient(135deg, #0E68B9 0%, #1a7fd8 100%);
        color: white;
        border: none;
    }

    .btn-next:hover, .btn-submit:hover {
        opacity: 0.9;
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(14, 104, 185, 0.3);
    }

    .btn-submit {
        background: linear-gradient(135deg, #10B981 0%, #34D399 100%);
    }

    .btn-submit:hover {
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
        .step-indicator {
            gap: 0.5rem;
        }

        .step {
            min-width: 60px;
        }

        .step-number {
            width: 32px;
            height: 32px;
            font-size: 0.875rem;
        }

        .step-title {
            font-size: 0.65rem;
        }

        .form-card {
            padding: 1rem;
        }

        .amenities-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .form-navigation {
            flex-direction: column;
            gap: 1rem;
        }

        .btn {
            width: 100%;
            justify-content: center;
        }
    }

    /* Feature Tags */
    .feature-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 1rem;
    }

    .feature-tag {
        background: linear-gradient(135deg, #FF6B00, #FF8C00);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
    }

    /* Price Preview */
    .price-preview {
        background: linear-gradient(135deg, #0E68B9 0%, #1a7fd8 100%);
        color: white;
        padding: 1.5rem;
        border-radius: 12px;
        text-align: center;
        margin-top: 1rem;
    }

    .price-preview h4 {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .price-preview .price {
        font-size: 2rem;
        font-weight: 700;
    }

    .price-preview .period {
        font-size: 0.875rem;
        opacity: 0.9;
    }

    /* Preview Card */
    .preview-card {
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .dark .preview-card {
        border-color: #4b5563;
    }

    .preview-card:hover {
        border-color: #0E68B9;
        transform: translateY(-2px);
    }

    .preview-image {
        height: 200px;
        background: linear-gradient(135deg, #e5e7eb, #d1d5db);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6b7280;
    }

    .dark .preview-image {
        background: linear-gradient(135deg, #374151, #4b5563);
        color: #9ca3af;
    }

    .preview-content {
        padding: 1.5rem;
    }

    .preview-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #111827;
        margin-bottom: 0.5rem;
    }

    .dark .preview-title {
        color: #f9fafb;
    }

    .preview-location {
        color: #6b7280;
        font-size: 0.875rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .dark .preview-location {
        color: #9ca3af;
    }

    .preview-details {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
        margin-bottom: 1rem;
    }

    .detail-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #4b5563;
        font-size: 0.875rem;
    }

    .dark .detail-item {
        color: #9ca3af;
    }

    .preview-price {
        font-size: 1.5rem;
        font-weight: 700;
        color: #0E68B9;
    }

    .dark .preview-price {
        color: #60a5fa;
    }

    /* Validation Errors */
    .error-message {
        color: #ef4444;
        font-size: 0.75rem;
        margin-top: 0.25rem;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .error-border {
        border-color: #ef4444 !important;
    }

    .error-border:focus {
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
    }

    /* Loading Overlay */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
    }

    .loading-overlay.active {
        display: flex;
        animation: fadeIn 0.3s ease-out;
    }

    .loading-spinner {
        width: 60px;
        height: 60px;
        border: 4px solid #f3f4f6;
        border-top: 4px solid #0E68B9;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>
{% endblock %}

{% block header_title %}
<h1 class="text-xl font-bold text-gray-900 dark:text-white">Create New Property</h1>
<p class="text-sm text-gray-600 dark:text-gray-400">
    Fill in the details to list your property on BHOOSPARSH
</p>
{% endblock %}

{% block header_buttons %}
<a href="{% url 'seller_properties' %}" 
   class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition flex items-center gap-2 hover-lift">
    <i class="fas fa-arrow-left"></i>
    <span>Back to Properties</span>
</a>
{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <!-- Step Indicator -->
    <div class="step-indicator">
        <div class="step active" data-step="1">
            <div class="step-number">1</div>
            <div class="step-title">Basic Info</div>
            <div class="step-line"></div>
        </div>
        <div class="step inactive" data-step="2">
            <div class="step-number">2</div>
            <div class="step-title">Property Details</div>
            <div class="step-line"></div>
        </div>
        <div class="step inactive" data-step="3">
            <div class="step-number">3</div>
            <div class="step-title">Amenities</div>
            <div class="step-line"></div>
        </div>
        <div class="step inactive" data-step="4">
            <div class="step-number">4</div>
            <div class="step-title">Photos</div>
            <div class="step-line"></div>
        </div>
        <div class="step inactive" data-step="5">
            <div class="step-number">5</div>
            <div class="step-title">Pricing</div>
        </div>
    </div>

    <!-- Property Creation Form -->
    <form id="propertyForm" method="POST" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}
        
        <!-- Step 1: Basic Information -->
        <div id="step1" class="step-content active">
            <div class="form-card card-animate stagger-1">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 rounded-full bg-bhoosparsh-blue-gradient flex items-center justify-center">
                        <i class="fas fa-info-circle text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white">Basic Information</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Tell us about your property</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="title" class="form-label">
                            Property Title <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="title" name="title" class="form-input" 
                               placeholder="e.g., Modern 3BHK Apartment with Mountain View" required>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            Be specific and descriptive to attract more buyers
                        </div>
                    </div>

                    <div>
                        <label for="property_type" class="form-label">
                            Property Type <span class="text-red-500">*</span>
                        </label>
                        <select id="property_type" name="property_type" class="form-select" required>
                            <option value="">Select Property Type</option>
                            <option value="apartment">Apartment</option>
                            <option value="villa">Villa</option>
                            <option value="house">House</option>
                            <option value="plot">Plot/Land</option>
                            <option value="commercial">Commercial</option>
                            <option value="farmhouse">Farm House</option>
                        </select>
                    </div>

                    <div class="md:col-span-2">
                        <label for="description" class="form-label">
                            Property Description <span class="text-red-500">*</span>
                        </label>
                        <textarea id="description" name="description" class="form-textarea" 
                                  placeholder="Describe your property in detail. Mention unique features, nearby amenities, and why it's special..." 
                                  rows="4" required></textarea>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            A detailed description increases engagement by 40%
                        </div>
                    </div>

                    <div>
                        <label for="address" class="form-label">
                            Complete Address <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="address" name="address" class="form-input" 
                               placeholder="Enter full address" required>
                    </div>

                    <div>
                        <label for="city" class="form-label">
                            City <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="city" name="city" class="form-input" 
                               placeholder="Enter city" required>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Property Details -->
        <div id="step2" class="step-content">
            <div class="form-card card-animate stagger-2">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 rounded-full bg-bhoosparsh-blue-gradient flex items-center justify-center">
                        <i class="fas fa-home text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white">Property Details</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Specifications and measurements</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label for="bedrooms" class="form-label">Bedrooms</label>
                        <select id="bedrooms" name="bedrooms" class="form-select">
                            <option value="">Select</option>
                            <option value="1">1 BHK</option>
                            <option value="2">2 BHK</option>
                            <option value="3">3 BHK</option>
                            <option value="4">4 BHK</option>
                            <option value="5+">5+ BHK</option>
                        </select>
                    </div>

                    <div>
                        <label for="bathrooms" class="form-label">Bathrooms</label>
                        <select id="bathrooms" name="bathrooms" class="form-select">
                            <option value="">Select</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4+">4+</option>
                        </select>
                    </div>

                    <div>
                        <label for="area" class="form-label">Area (sq ft) <span class="text-red-500">*</span></label>
                        <input type="number" id="area" name="area" class="form-input" 
                               placeholder="e.g., 1500" min="0" required>
                    </div>

                    <div>
                        <label for="floor" class="form-label">Floor Number</label>
                        <input type="number" id="floor" name="floor" class="form-input" 
                               placeholder="e.g., 5">
                    </div>

                    <div>
                        <label for="total_floors" class="form-label">Total Floors</label>
                        <input type="number" id="total_floors" name="total_floors" class="form-input" 
                               placeholder="e.g., 15">
                    </div>

                    <div>
                        <label for="year_built" class="form-label">Year Built</label>
                        <input type="number" id="year_built" name="year_built" class="form-input" 
                               placeholder="e.g., 2018" min="1900" max="2024">
                    </div>

                    <div class="md:col-span-3">
                        <label class="form-label mb-3">Additional Features</label>
                        <div class="feature-tags">
                            <span class="feature-tag"><i class="fas fa-car"></i> Parking</span>
                            <span class="feature-tag"><i class="fas fa-swimming-pool"></i> Swimming Pool</span>
                            <span class="feature-tag"><i class="fas fa-tree"></i> Garden</span>
                            <span class="feature-tag"><i class="fas fa-dumbbell"></i> Gym</span>
                            <span class="feature-tag"><i class="fas fa-shield-alt"></i> Security</span>
                            <span class="feature-tag"><i class="fas fa-wind"></i> Furnished</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: Amenities -->
        <div id="step3" class="step-content">
            <div class="form-card card-animate stagger-3">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 rounded-full bg-bhoosparsh-blue-gradient flex items-center justify-center">
                        <i class="fas fa-star text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white">Amenities & Facilities</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Select all available amenities</p>
                    </div>
                </div>

                <div class="amenities-grid">
                    {% for amenity in amenities %}
                    <div class="amenity-item" data-amenity="{{ amenity.id }}">
                        <div class="amenity-checkbox">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <span class="amenity-name">{{ amenity.name }}</span>
                    </div>
                    {% empty %}
                    <!-- Default amenities if none provided -->
                    <div class="amenity-item" data-amenity="parking">
                        <div class="amenity-checkbox">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <span class="amenity-name">Parking</span>
                    </div>
                    <div class="amenity-item" data-amenity="pool">
                        <div class="amenity-checkbox">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <span class="amenity-name">Swimming Pool</span>
                    </div>
                    <div class="amenity-item" data-amenity="gym">
                        <div class="amenity-checkbox">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <span class="amenity-name">Gym</span>
                    </div>
                    <div class="amenity-item" data-amenity="security">
                        <div class="amenity-checkbox">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <span class="amenity-name">24/7 Security</span>
                    </div>
                    <div class="amenity-item" data-amenity="lift">
                        <div class="amenity-checkbox">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <span class="amenity-name">Lift/Elevator</span>
                    </div>
                    <div class="amenity-item" data-amenity="power">
                        <div class="amenity-checkbox">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <span class="amenity-name">Power Backup</span>
                    </div>
                    <div class="amenity-item" data-amenity="water">
                        <div class="amenity-checkbox">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <span class="amenity-name">24/7 Water Supply</span>
                    </div>
                    <div class="amenity-item" data-amenity="internet">
                        <div class="amenity-checkbox">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <span class="amenity-name">High-Speed Internet</span>
                    </div>
                    {% endfor %}
                </div>
                <input type="hidden" id="amenities" name="amenities">
            </div>
        </div>

        <!-- Step 4: Photos -->
        <div id="step4" class="step-content">
            <div class="form-card card-animate stagger-4">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 rounded-full bg-bhoosparsh-blue-gradient flex items-center justify-center">
                        <i class="fas fa-camera text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white">Property Photos</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Upload high-quality images (Max 10)</p>
                    </div>
                </div>

                <div class="image-upload-area" id="dropZone">
                    <div class="flex flex-col items-center justify-center gap-4">
                        <div class="w-16 h-16 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                            <i class="fas fa-cloud-upload-alt text-blue-500 text-2xl"></i>
                        </div>
                        <div class="text-center">
                            <p class="font-medium text-gray-900 dark:text-white mb-1">
                                Drag & drop images here
                            </p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                or click to browse (JPG, PNG, max 5MB each)
                            </p>
                        </div>
                        <input type="file" id="imageUpload" name="images" multiple accept="image/*" 
                               class="hidden" onchange="handleImageUpload(event)">
                        <button type="button" onclick="document.getElementById('imageUpload').click()" 
                                class="px-4 py-2 bg-bhoosparsh-blue-gradient text-white rounded-lg hover:opacity-90 transition">
                            <i class="fas fa-plus mr-2"></i>Select Images
                        </button>
                    </div>
                </div>

                <div id="imagePreview" class="image-preview mt-6"></div>

                <div class="mt-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-700">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-lightbulb text-yellow-500 text-lg mt-0.5"></i>
                        <div>
                            <p class="font-medium text-gray-900 dark:text-white">Photo Tips</p>
                            <ul class="text-sm text-gray-600 dark:text-gray-400 mt-1 space-y-1">
                                <li>• Upload clear, well-lit photos in landscape orientation</li>
                                <li>• Include photos of all rooms, exterior, and nearby areas</li>
                                <li>• First image will be used as the main thumbnail</li>
                                <li>• Properties with 5+ photos get 3x more views</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 5: Pricing & Final Step -->
        <div id="step5" class="step-content">
            <div class="form-card card-animate stagger-5">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 rounded-full bg-bhoosparsh-blue-gradient flex items-center justify-center">
                        <i class="fas fa-tag text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white">Pricing & Final Details</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Set your price and preferences</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="price" class="form-label">
                            Price <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">₹</span>
                            <input type="number" id="price" name="price" class="form-input pl-10" 
                                   placeholder="e.g., 7500000" min="0" required>
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            Competitive pricing attracts more buyers
                        </div>
                    </div>

                    <div>
                        <label for="price_unit" class="form-label">Price Unit</label>
                        <select id="price_unit" name="price_unit" class="form-select">
                            <option value="total">Total Price</option>
                            <option value="per_sqft">Per Sq Ft</option>
                            <option value="per_month">Per Month (Rent)</option>
                        </select>
                    </div>

                    <div>
                        <label for="negotiable" class="form-label mb-3 block">Price Negotiable?</label>
                        <div class="flex items-center gap-4">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="negotiable" value="yes" class="w-4 h-4 text-bhoosparsh-blue" checked>
                                <span class="text-gray-700 dark:text-gray-300">Yes</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="negotiable" value="no" class="w-4 h-4 text-bhoosparsh-blue">
                                <span class="text-gray-700 dark:text-gray-300">No</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <label for="availability" class="form-label">Availability</label>
                        <select id="availability" name="availability" class="form-select">
                            <option value="immediate">Immediate</option>
                            <option value="15_days">Within 15 Days</option>
                            <option value="30_days">Within 30 Days</option>
                            <option value="2_months">Within 2 Months</option>
                        </select>
                    </div>

                    <div class="md:col-span-2">
                        <label for="contact_preference" class="form-label mb-3 block">Contact Preference</label>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <label class="flex items-center gap-2 p-3 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:border-bhoosparsh-blue transition">
                                <input type="checkbox" name="contact_preference" value="call" class="w-4 h-4 text-bhoosparsh-blue" checked>
                                <i class="fas fa-phone text-green-500"></i>
                                <span class="text-gray-700 dark:text-gray-300">Phone Calls</span>
                            </label>
                            <label class="flex items-center gap-2 p-3 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:border-bhoosparsh-blue transition">
                                <input type="checkbox" name="contact_preference" value="whatsapp" class="w-4 h-4 text-bhoosparsh-blue" checked>
                                <i class="fab fa-whatsapp text-green-500"></i>
                                <span class="text-gray-700 dark:text-gray-300">WhatsApp</span>
                            </label>
                            <label class="flex items-center gap-2 p-3 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:border-bhoosparsh-blue transition">
                                <input type="checkbox" name="contact_preference" value="email" class="w-4 h-4 text-bhoosparsh-blue" checked>
                                <i class="fas fa-envelope text-blue-500"></i>
                                <span class="text-gray-700 dark:text-gray-300">Email</span>
                            </label>
                        </div>
                    </div>

                    <div class="md:col-span-2">
                        <div class="price-preview">
                            <h4>Estimated Market Value</h4>
                            <div class="price">₹ <span id="estimatedPrice">00,00,000</span></div>
                            <p class="period">Based on similar properties in your area</p>
                        </div>
                    </div>
                </div>

                <!-- Preview Section -->
                <div class="mt-8">
                    <h4 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Preview</h4>
                    <div class="preview-card">
                        <div class="preview-image">
                            <i class="fas fa-home text-4xl"></i>
                        </div>
                        <div class="preview-content">
                            <h5 class="preview-title" id="previewTitle">Your Property Title</h5>
                            <p class="preview-location" id="previewLocation">
                                <i class="fas fa-map-marker-alt"></i> Your Location
                            </p>
                            <div class="preview-details">
                                <div class="detail-item">
                                    <i class="fas fa-bed"></i>
                                    <span id="previewBedrooms">-</span> Beds
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-bath"></i>
                                    <span id="previewBathrooms">-</span> Baths
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-vector-square"></i>
                                    <span id="previewArea">-</span> sq ft
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-building"></i>
                                    <span id="previewType">-</span>
                                </div>
                            </div>
                            <div class="preview-price" id="previewPrice">₹ 00,00,000</div>
                        </div>
                    </div>
                </div>

                <!-- Terms & Conditions -->
                <div class="mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg">
                    <label class="flex items-start gap-3 cursor-pointer">
                        <input type="checkbox" id="terms" class="w-4 h-4 mt-1 text-bhoosparsh-blue" required>
                        <span class="text-sm text-gray-700 dark:text-gray-300">
                            I agree to the <a href="#" class="text-bhoosparsh-blue hover:underline">Terms & Conditions</a> 
                            and confirm that all information provided is accurate to the best of my knowledge. 
                            I understand that false information may lead to removal of the listing.
                        </span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="form-navigation">
            <button type="button" id="prevBtn" class="btn btn-prev" onclick="prevStep()" style="display: none;">
                <i class="fas fa-arrow-left"></i> Previous
            </button>
            <button type="button" id="nextBtn" class="btn btn-next ml-auto" onclick="nextStep()">
                Next <i class="fas fa-arrow-right"></i>
            </button>
            <button type="submit" id="submitBtn" class="btn btn-submit" style="display: none;">
                <i class="fas fa-paper-plane"></i> Publish Property
            </button>
        </div>
    </form>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-spinner"></div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Form Wizard Logic
    let currentStep = 1;
    const totalSteps = 5;
    const amenities = new Set();
    const uploadedImages = [];
    const maxImages = 10;

    document.addEventListener('DOMContentLoaded', function() {
        // Initialize form wizard
        updateStepIndicator();
        
        // Setup event listeners
        setupFormListeners();
        
        // Initialize image drop zone
        initImageDropZone();
        
        // Setup preview updates
        setupPreviewUpdates();
        
        // Validate required fields on blur
        setupFieldValidation();
    });

    function updateStepIndicator() {
        // Update all steps
        document.querySelectorAll('.step').forEach((step, index) => {
            const stepNumber = parseInt(step.dataset.step);
            
            step.classList.remove('active', 'completed', 'inactive');
            
            if (stepNumber === currentStep) {
                step.classList.add('active');
            } else if (stepNumber < currentStep) {
                step.classList.add('completed');
            } else {
                step.classList.add('inactive');
            }
        });
        
        // Show/hide step content
        document.querySelectorAll('.step-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(`step${currentStep}`).classList.add('active');
        
        // Update navigation buttons
        updateNavigationButtons();
        
        // Update preview
        updatePreview();
    }

    function updateNavigationButtons() {
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        
        prevBtn.style.display = currentStep > 1 ? 'inline-flex' : 'none';
        nextBtn.style.display = currentStep < totalSteps ? 'inline-flex' : 'none';
        submitBtn.style.display = currentStep === totalSteps ? 'inline-flex' : 'none';
        
        if (currentStep === totalSteps) {
            nextBtn.innerHTML = 'Next <i class="fas fa-arrow-right"></i>';
        }
    }

    function nextStep() {
        if (!validateCurrentStep()) {
            showToast('Please fill all required fields correctly', 'error');
            return;
        }
        
        if (currentStep < totalSteps) {
            currentStep++;
            updateStepIndicator();
            scrollToTop();
        }
    }

    function prevStep() {
        if (currentStep > 1) {
            currentStep--;
            updateStepIndicator();
            scrollToTop();
        }
    }

    function validateCurrentStep() {
        const currentStepElement = document.getElementById(`step${currentStep}`);
        const requiredFields = currentStepElement.querySelectorAll('[required]');
        
        for (const field of requiredFields) {
            if (!field.value.trim()) {
                field.classList.add('error-border');
                field.focus();
                return false;
            }
            field.classList.remove('error-border');
        }
        
        // Special validation for step 4 (images)
        if (currentStep === 4 && uploadedImages.length === 0) {
            showToast('Please upload at least one image of your property', 'warning');
            return false;
        }
        
        return true;
    }

    function setupFormListeners() {
        // Amenity selection
        document.querySelectorAll('.amenity-item').forEach(item => {
            item.addEventListener('click', function() {
                const amenityId = this.dataset.amenity;
                
                this.classList.toggle('selected');
                
                if (this.classList.contains('selected')) {
                    amenities.add(amenityId);
                } else {
                    amenities.delete(amenityId);
                }
                
                // Update hidden input
                document.getElementById('amenities').value = Array.from(amenities).join(',');
            });
        });
        
        // Real-time validation
        document.querySelectorAll('[required]').forEach(field => {
            field.addEventListener('blur', function() {
                if (!this.value.trim()) {
                    this.classList.add('error-border');
                } else {
                    this.classList.remove('error-border');
                }
            });
        });
        
        // Price input formatting
        const priceInput = document.getElementById('price');
        if (priceInput) {
            priceInput.addEventListener('input', function() {
                const value = parseInt(this.value.replace(/\D/g, '') || 0);
                this.value = value.toLocaleString('en-IN');
                updatePreview();
            });
        }
    }

    function initImageDropZone() {
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('imageUpload');
        
        // Drag and drop events
        dropZone.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
        });
        
        dropZone.addEventListener('dragleave', function() {
            this.classList.remove('dragover');
        });
        
        dropZone.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            handleImageUpload({ target: { files } });
        });
    }

    function handleImageUpload(event) {
        const files = event.target.files;
        const imagePreview = document.getElementById('imagePreview');
        
        if (uploadedImages.length + files.length > maxImages) {
            showToast(`Maximum ${maxImages} images allowed`, 'error');
            return;
        }
        
        for (const file of files) {
            if (!file.type.startsWith('image/')) {
                showToast('Please upload only image files', 'error');
                continue;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showToast('File size should be less than 5MB', 'error');
                continue;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageId = 'img-' + Date.now() + Math.random();
                uploadedImages.push({
                    id: imageId,
                    file: file,
                    dataUrl: e.target.result
                });
                
                // Create preview item
                const previewItem = document.createElement('div');
                previewItem.className = 'image-preview-item';
                previewItem.innerHTML = `
                    <img src="${e.target.result}" alt="Property Image">
                    <div class="image-remove-btn" onclick="removeImage('${imageId}')">
                        <i class="fas fa-times"></i>
                    </div>
                `;
                imagePreview.appendChild(previewItem);
            };
            reader.readAsDataURL(file);
        }
        
        // Reset file input
        event.target.value = '';
        
        if (uploadedImages.length > 0) {
            showToast(`${uploadedImages.length} image(s) uploaded successfully`, 'success');
        }
    }

    function removeImage(imageId) {
        const index = uploadedImages.findIndex(img => img.id === imageId);
        if (index > -1) {
            uploadedImages.splice(index, 1);
        }
        
        // Remove preview element
        const previewElement = document.querySelector(`[onclick="removeImage('${imageId}')"]`).parentElement;
        previewElement.remove();
    }

    function setupPreviewUpdates() {
        // Update preview on input change
        const previewFields = ['title', 'city', 'address', 'bedrooms', 'bathrooms', 'area', 'property_type', 'price'];
        
        previewFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('input', updatePreview);
                field.addEventListener('change', updatePreview);
            }
        });
    }

    function updatePreview() {
        // Update preview title
        const title = document.getElementById('title').value || 'Your Property Title';
        document.getElementById('previewTitle').textContent = title.substring(0, 50) + (title.length > 50 ? '...' : '');
        
        // Update preview location
        const city = document.getElementById('city').value || '';
        const address = document.getElementById('address').value || '';
        const location = city || address ? `${city}, ${address.substring(0, 30)}` : 'Your Location';
        document.getElementById('previewLocation').innerHTML = `<i class="fas fa-map-marker-alt"></i> ${location}`;
        
        // Update preview details
        document.getElementById('previewBedrooms').textContent = 
            document.getElementById('bedrooms').value || '-';
        document.getElementById('previewBathrooms').textContent = 
            document.getElementById('bathrooms').value || '-';
        document.getElementById('previewArea').textContent = 
            document.getElementById('area').value ? 
            parseInt(document.getElementById('area').value).toLocaleString('en-IN') : '-';
        document.getElementById('previewType').textContent = 
            document.getElementById('property_type').value ? 
            document.getElementById('property_type').options[document.getElementById('property_type').selectedIndex].text : '-';
        
        // Update preview price
        const price = document.getElementById('price').value || '00,00,000';
        document.getElementById('previewPrice').textContent = `₹ ${price}`;
        document.getElementById('estimatedPrice').textContent = price;
        
        // Calculate estimated price based on area and city
        const area = parseInt(document.getElementById('area').value) || 0;
        if (area > 0) {
            const ratePerSqFt = getRatePerSqFt();
            const estimated = area * ratePerSqFt;
            document.getElementById('estimatedPrice').textContent = 
                Math.round(estimated).toLocaleString('en-IN');
        }
    }

    function getRatePerSqFt() {
        // This would ideally come from your backend based on location
        // For now, using a default rate
        return 5000; // ₹5000 per sq ft
    }

    function setupFieldValidation() {
        const form = document.getElementById('propertyForm');
        form.addEventListener('submit', function(e) {
            if (!validateCurrentStep()) {
                e.preventDefault();
                showToast('Please fill all required fields correctly', 'error');
                return;
            }

            if (uploadedImages.length < 3) {
                e.preventDefault();
                showToast('Please upload at least 3 images of your property', 'error');
                return;
            }

            if (!document.getElementById('terms').checked) {
                e.preventDefault();
                showToast('Please accept the Terms & Conditions', 'error');
                return;
            }

            // Show loading overlay
            document.getElementById('loadingOverlay').classList.add('active');

            // Add uploaded images to the form before submission
            const imageInput = document.createElement('input');
            imageInput.type = 'hidden';
            imageInput.name = 'uploaded_images_count';
            imageInput.value = uploadedImages.length;
            form.appendChild(imageInput);

            // The form will submit normally with multipart/form-data
            // Django will handle the file uploads automatically
        });
    }

    function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Helper functions from base template
    function showToast(message, type = 'info') {
        const container = document.getElementById('toast-container');
        if (!container) return;
        
        const toast = document.createElement('div');
        const toastId = 'toast-' + Date.now();
        
        const icons = {
            info: 'fa-info-circle',
            success: 'fa-check-circle',
            error: 'fa-exclamation-circle',
            warning: 'fa-exclamation-triangle'
        };
        
        const colors = {
            info: 'bg-blue-500',
            success: 'bg-green-500',
            error: 'bg-red-500',
            warning: 'bg-yellow-500'
        };
        
        toast.id = toastId;
        toast.className = `${colors[type]} text-white p-4 rounded-lg shadow-lg flex items-center gap-3 animate-slideInRight mb-2`;
        toast.innerHTML = `
            <i class="fas ${icons[type]}"></i>
            <span class="flex-1">${message}</span>
            <button onclick="removeToast('${toastId}')" class="text-white/80 hover:text-white">
                <i class="fas fa-times"></i>
            </button>
        `;
        
        container.appendChild(toast);
        
        setTimeout(() => {
            removeToast(toastId);
        }, 3000);
    }

    function removeToast(id) {
        const toast = document.getElementById(id);
        if (toast) {
            toast.style.animation = 'slideInRight 0.3s ease-out reverse';
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 300);
        }
    }
</script>
{% endblock %}